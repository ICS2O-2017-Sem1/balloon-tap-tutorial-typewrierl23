var requirejs,require,define;!function(e){function t(e,t){return b.call(e,t)}function s(e,t){var s,i,n,r,o,a,l,c,d,h,u,p=t&&t.split("/"),g=f.map,m=g&&g["*"]||{};if(e){for(o=(e=e.split("/")).length-1,f.nodeIdCompat&&w.test(e[o])&&(e[o]=e[o].replace(w,"")),"."===e[0].charAt(0)&&p&&(e=p.slice(0,p.length-1).concat(e)),d=0;d<e.length;d++)if("."===(u=e[d]))e.splice(d,1),d-=1;else if(".."===u){if(0===d||1===d&&".."===e[2]||".."===e[d-1])continue;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}if((p||m)&&g){for(d=(s=e.split("/")).length;d>0;d-=1){if(i=s.slice(0,d).join("/"),p)for(h=p.length;h>0;h-=1)if((n=g[p.slice(0,h).join("/")])&&(n=n[i])){r=n,a=d;break}if(r)break;!l&&m&&m[i]&&(l=m[i],c=d)}!r&&l&&(r=l,a=c),r&&(s.splice(0,a,r),e=s.join("/"))}return e}function i(t,s){return function(){var i=v.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),h.apply(e,i.concat([t,s]))}}function n(e){return function(t){return s(t,e)}}function r(e){return function(t){g[e]=t}}function o(s){if(t(m,s)){var i=m[s];delete m[s],y[s]=!0,d.apply(e,i)}if(!t(g,s)&&!t(y,s))throw new Error("No "+s);return g[s]}function a(e){var t,s=e?e.indexOf("!"):-1;return s>-1&&(t=e.substring(0,s),e=e.substring(s+1,e.length)),[t,e]}function l(e){return e?a(e):[]}function c(e){return function(){return f&&f.config&&f.config[e]||{}}}var d,h,u,p,g={},m={},f={},y={},b=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;u=function(e,t){var i,r=a(e),l=r[0],c=t[1];return e=r[1],l&&(i=o(l=s(l,c))),l?e=i&&i.normalize?i.normalize(e,n(c)):s(e,c):(l=(r=a(e=s(e,c)))[0],e=r[1],l&&(i=o(l))),{f:l?l+"!"+e:e,n:e,pr:l,p:i}},p={require:function(e){return i(e)},exports:function(e){var t=g[e];return void 0!==t?t:g[e]={}},module:function(e){return{id:e,uri:"",exports:g[e],config:c(e)}}},d=function(s,n,a,c){var d,h,f,b,v,w,k,_=[],L=typeof a;if(c=c||s,w=l(c),"undefined"===L||"function"===L){for(n=!n.length&&a.length?["require","exports","module"]:n,v=0;v<n.length;v+=1)if(b=u(n[v],w),"require"===(h=b.f))_[v]=p.require(s);else if("exports"===h)_[v]=p.exports(s),k=!0;else if("module"===h)d=_[v]=p.module(s);else if(t(g,h)||t(m,h)||t(y,h))_[v]=o(h);else{if(!b.p)throw new Error(s+" missing "+h);b.p.load(b.n,i(c,!0),r(h),{}),_[v]=g[h]}f=a?a.apply(g[s],_):void 0,s&&(d&&d.exports!==e&&d.exports!==g[s]?g[s]=d.exports:f===e&&k||(g[s]=f))}else s&&(g[s]=a)},requirejs=require=h=function(t,s,i,n,r){if("string"==typeof t)return p[t]?p[t](s):o(u(t,l(s)).f);if(!t.splice){if((f=t).deps&&h(f.deps,f.callback),!s)return;s.splice?(t=s,s=i,i=null):t=e}return s=s||function(){},"function"==typeof i&&(i=n,n=r),n?d(e,t,s,i):setTimeout(function(){d(e,t,s,i)},4),h},h.config=function(e){return h(e)},requirejs._defined=g,(define=function(e,s,i){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");s.splice||(i=s,s=[]),t(g,e)||t(m,e)||(m[e]=[e,s,i])}).amd={jQuery:!0}}(),define("../../../bower_components/almond/almond",function(){}),define("templates",["require"],function(e){"use strict";return function(e,t){return window.FTWTEMPLATES[e+"_"+t]?window.FTWTEMPLATES[e+"_"+t]:(console.error("Unable to find template: "+e+"_"+t),function(){return"Unable to find template: "+e+"_"+t})}}),define("registry",["require"],function(e){"use strict";var t=[];return{get:function(e){return t[e]||void 0},set:function(e,s){t[e]=s}}}),define("shared/scoring",["require"],function(e){"use strict";return{speed:function(e,t,s,i){"object"==typeof e&&(t=e.seconds,s=e.errors,i=e.speedType,e=e.typed),i=i||"wpm",s=s||0;var n,r,o=t/60;return"kph"===i?r=Math.round(e/t*3600):"cpm"===i?(n=e,r=Math.max(Math.round(n/o),0)):(n=e/5,r=Math.max(Math.round(n/o),0)),r===1/0||isNaN(r)?0:r},accuracy:function(e,t){"object"==typeof e&&(t=e.errors,e=e.typed);var s;return e=e||1,s=100-Math.round(t/e*100),isNaN(s)?0:s},stars:function(e,t,s){return t=t||90,s=s||95,e<t?1:e<s?2:3}}}),define("global/views/confirm",["require","templates"],function(e){"use strict";var t=e("templates");return Backbone.View.extend({className:"popup-wrap",events:{"click .close":"cancel","click .ok":"ok"},initialize:function(e){this.options=e||{},this.options.position="fixed",this.template=t("global","confirm"),this.render()},render:function(){return this.$el.html(this.template({title:this.options.title,text:this.options.text,ok:this.options.ok||"OK",cancel:this.options.cancel||"Cancel"})).fastHide(),$("body").append(this.el),this},cancel:function(){return this.trigger("close",!1),this.close(),!1},ok:function(){return this.trigger("close",!0),this.options.doNotClose?this.$(".ok").addClass("pending"):this.close(),!1},close:function(){return this.$el.velocity("fadeOut",this.remove.bind(this)),!1},show:function(){return this.render(),this.$el.velocity("fadeIn"),this}})}),define("global/collections/badges",["require","templates"],function(e){"use strict";var t=e("templates"),s=Backbone.Model.extend({});return Backbone.Collection.extend({model:s,totalBadges:12,initialize:function(){for(var e=[],s=1;s<=this.totalBadges;s++)e.push({id:s,template:t("badges","badge"+s)});this.reset(e)}})}),define("global/models/lesson",["require"],function(e){"use strict";return Backbone.Model.extend({idAttribute:"lesson_id",defaults:{name:"",course:"",intro:"",seconds:0,typed:0,errors:0,congrats:"",progress:0,max_progress:0}})}),define("global/collections/lessons",["require","global/models/lesson","shared/scoring"],function(e){"use strict";var t=e("global/models/lesson"),s=e("shared/scoring");return Backbone.Collection.extend({model:t,comparator:"sort_order",setProgress:function(e){e.forEach(function(e){var t=this.get(e.id);t&&"test"!=t.get("course")&&"problemkeys"!=t.get("course")&&this.get(e.id).set({progress:e.get("progress"),max_progress:Math.max(e.get("progress"),e.get("max_progress")),speed:s.speed(e.get("typed"),e.get("seconds"),e.get("errors")),accuracy:s.accuracy(e.get("typed"),e.get("errors")),stars:e.get("stars"),updated_at:e.get("updated_at")})}.bind(this))}})}),define("index/views/dashboard",["require","templates","shared/scoring","registry","global/views/confirm","global/collections/badges","global/collections/lessons"],function(e){"use strict";var t=e("templates"),s=e("shared/scoring"),i=e("registry"),n=e("global/views/confirm"),r=e("global/collections/badges"),o=e("global/collections/lessons");return Backbone.View.extend({daysBack:1,events:{"click .clear":"clearProblemKeys","click .filter span":"changeTime","mouseenter .badge":"hoverBadge","mouseleave .badge":"hoverBadge"},initialize:function(e){this.options=e,void 0===this.template&&(this.template=t("index","dashboard")),this.userBadges=i.get("userBadges"),this.user=i.get("user"),this.userLettersTyped=i.get("userLettersTyped"),this.userActivity=i.get("userActivity"),this.lessons=new o(FTWGLOBALS("lessons")),this.badges=new r,this.render()},render:function(){var e=this.userActivity.getCompiled(this.daysBack),t=this.userBadges.last(),i=this.userLettersTyped.topProblemKeys(3).map(function(e){return e.id.toUpperCase()}),n=this.badges.get(1).get("template");if(t){t=t.toJSON();var r=this.lessons.get(t.lesson_id);t.lesson=r.get("name"),t.speed=s.speed(t),t.accuracy=s.accuracy(t),t.course=r.get("course"),n=this.badges.get(r.get("badge")||1).get("template")}var o=i.join("");return"FUK"==o&&(o="UKF"),this.$el.html(this.template({zeroState:0===this.userActivity.length&&FTWGLOBALS("loggedIn"),daysBack:this.daysBack,user:this.user.toJSON(),speed:s.speed(e.typed,e.seconds,e.errors),accuracy:s.accuracy(e.typed,e.errors),time:e.seconds,keys:o,loggedIn:FTWGLOBALS("loggedIn"),badge:t,badgeTemplate:n})),this},changeTime:function(e){this.daysBack=$(e.currentTarget).data("id");var t=this.userActivity.getCompiled(this.daysBack);this.$("#dashboard-speed").countdown(s.speed(t.typed,t.seconds,t.errors),null,400).parent().velocity("fadeIn"),this.$("#dashboard-accuracy").countdown(s.accuracy(t.typed,t.errors),null,400).parent().velocity("fadeIn");var i=this.$("#dashboard-time"),n=i.data("data");return i.data("data",t.seconds),i.countdown([t.seconds,n],{formatter:function(e){return e.countdownSeconds()}},400).parent().velocity("fadeIn"),this.$(".filter span").removeClass("active"),this.$(".filter span[data-id="+this.daysBack+"]").addClass("active"),!1},clearProblemKeys:function(){return new n({title:"Clear Your Problem Keys?",text:"Are you sure you would like to clear your Problem Keys?<br /><br />Problem Keys will begin tracking again moving forward."}).show().once("close",function(e){e&&(this.userLettersTyped.clear(),this.render())}.bind(this)),!1},hoverBadge:function(e){"mouseenter"==e.type?$(e.currentTarget).velocity("stop",!0).velocity({scale:[1.2,1]},100):$(e.currentTarget).velocity("stop",!0).velocity("reverse",50)}})}),define("index/views/migration",["require","templates","shared/scoring","registry"],function(e){"use strict";var t=e("templates"),s=(e("shared/scoring"),e("registry"));return Backbone.View.extend({events:{"click .close-button":"hide"},initialize:function(e){this.options=e,void 0===this.template&&(this.template=t("index","migration")),this.user=s.get("user"),this.render()},render:function(){return this.$el.html(this.template({teacherId:this.user.get("teacher_id")})),this},hide:function(){this.$("input[type=checkbox]").prop("checked")&&$.post("/apiv1/student/user/account",{migrated:2}),this.user.set({migrated:0}),this.$el.velocity("slideUp")}})}),define("global/collections/courses",["require"],function(e){"use strict";var t=Backbone.Model.extend({idAttribute:"course",defaults:{course:"",sort_order:0}});return Backbone.Collection.extend({model:t,sort:"sort_order",setProgress:function(e){var t,s,i=e.toJSON();this.forEach(function(e){if("test"!=e.get("type")&&"problemkeys"!=e.get("type")){var n=(s=_.where(i,{course:e.id})).reduce(function(e,t){return e+t.max_progress},0);if(n>0){var r=_.indexOf(s,_.max(s,function(e){return e.max_progress==e.screens?e.updated_at:0})),o=_.max(s,function(e){return e.max_progress==e.screens?0:e.updated_at}),a=_.max(s,function(e){return e.updated_at});if(o.max_progress==o.screens&&(o=null),-1==r)(t=_.max(s,function(e){return e.updated_at})).max_progress==t.screens&&(t=null);else if(a.max_progress!=a.screens)t=a;else if(r==s.length-1)t=null;else{var l=s.slice(r).filter(function(e){return e.max_progress<e.screens});t=l.length?l[0]:null}if(!t)if(o)t=o;else{var c=s.filter(function(e){return e.max_progress<e.screens});t=c.length?c[0]:null}}else t=_.where(i,{course:e.id})[0];e.set({progress:n,active_lesson:t?t.lesson_id:null,screens:s.reduce(function(e,t){return e+t.screens},0)})}})}})}),define("global/collections/user_lesson_screens",["require"],function(e){"use strict";var t=Backbone.Model.extend({idAttribute:"lesson_screen_id",defaults:{lesson_id:0,lesson_screen_id:0,seconds:0,errors:0,typed:0,stars:0,created_at:0}});return Backbone.Collection.extend({model:t,url:function(){return"/apiv1/student/lessons/"+this.options.lesson_id+"/screens"},initialize:function(e,t){this.options=t}})}),define("shared/model_backends/localstorage",["require"],function(e){"use strict";var t=[],s=function(e){this.table=e};return s.prototype.setModel=function(e){t.push(e),this.model=e},s.prototype.getData=function(){return void 0===window.localStorage[rot47(this.table)]?null:JSON.parse(rot47(window.localStorage[rot47(this.table)]))},s.prototype.setData=function(e){window.localStorage[rot47(this.table)]=rot47(JSON.stringify(e))},s.prototype.change=function(){this.setData(this.model.toJSON())},s.prototype.add=s.prototype.change,s.prototype.remove=s.prototype.change,s.prototype.reset=s.prototype.change,s.prototype.sort=s.prototype.change,s.clear=function(){t.forEach(function(e){e.off("change")}),localStorage.clear()},s}),define("index/index",["require","templates","registry","shared/scoring","index/views/dashboard","index/views/migration","global/collections/courses","global/collections/lessons","global/collections/user_lesson_screens","shared/model_backends/localstorage","global/views/confirm"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=(e("shared/scoring"),e("index/views/dashboard")),n=e("index/views/migration"),r=e("global/collections/courses"),o=e("global/collections/lessons"),a=e("global/collections/user_lesson_screens"),l=e("shared/model_backends/localstorage"),c=e("global/views/confirm");return Backbone.View.extend({el:"#js-content",events:{"mouseenter .path":"showCourse","mouseenter .lesson":"hoverLesson","mouseleave .lesson":"hoverLesson","mouseenter .path .button":"hoverButton","mouseleave .path .button":"hoverButton","click .restart":"restartLesson"},initialize:function(e){this.options=e||{},this.user=s.get("user"),this.courses=new r(FTWGLOBALS("courses")),this.lessons=new o(FTWGLOBALS("lessons")),this.userLessons=s.get("userLessons"),FTWGLOBALS("loggedIn")||(this.userLessons.forEach(function(e){new l("userLessonScreens"+e.id).setData(null)}),this.userLessons.reset(),this.user.clearLocalProgress()),this.dashboardView=new i({}),this.updateModelsWithProgress(),void 0===this.template&&(this.template=t("index","index")),this.render()},restartLesson:function(e){var t=$(e.currentTarget).data("id"),s=this.userLessons.get(t),i=new c({title:"Restart Lesson: "+this.lessons.get(t).get("name"),text:"Are you sure you would like to restart the lesson?",doNotClose:!0});return i.show().once("close",function(e){e?s.restart().done(function(){s.set({progress:0,max_progress:0,stars:0,typed:0,seconds:0,errors:0});var e=new a(null,{lesson_id:s.id});e.setBackend(new l("userLessonScreens"+s.id),"backend"),e.reset(),location.href="/student/lessons/"+s.id}.bind(this)).fail(function(){alert("There was an error resetting your lesson!")}):i.close()}.bind(this)),!1},updateModelsWithProgress:function(){this.lessons.setProgress(this.userLessons),this.courses.setProgress(this.lessons)},createPie:function(e){var t,s,i,n,r,o,a,l=this.lessons.where({course:e}),c=1/l.length*360,d=0,h=-90;(t=this.$("#course-pie-"+e)[0])&&_.sortBy(l,function(e){return e.get("max_progress")==e.get("screens")?0:1}).forEach(function(e,l){h=(d=h)+c,s=parseInt(Math.round(200+195*Math.cos(Math.PI*d/180))),n=parseInt(Math.round(200+195*Math.sin(Math.PI*d/180))),i=parseInt(Math.round(200+195*Math.cos(Math.PI*h/180))),r=parseInt(Math.round(200+195*Math.sin(Math.PI*h/180))),o="M200,200  L"+s+","+n+"  A195,195 0 "+(h-d>180?1:0)+",1 "+i+","+r+" z",(a=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d",o),a.setAttribute("class",e.get("max_progress")==e.get("screens")?"complete":""),t.appendChild(a)})},render:function(){var e=this.userLessons.sortBy(function(e){return-e.get("updated_at")})[0],t=e&&this.lessons.get(e.id)?this.lessons.get(e.id).get("course"):"beginner";if("test"==t&&(t="beginner"),this.$el.append(this.template({loggedIn:FTWGLOBALS("loggedIn"),currentCourse:t,courses:this.courses.toJSON(),lessons:this.lessons.toJSON(),user:this.user.toJSON()})),1==this.user.get("migrated"))new n({el:this.$("#migrationContent")});this.dashboardView&&this.$("#dashboardContent").html(this.dashboardView.el),this.courses.forEach(function(e){this.createPie(e.id)}.bind(this))},showCourse:function(e){var t=$(e.currentTarget);if(t.hasClass("active"))return!1;var s=this.$("#lessons-course-"+$(e.currentTarget).data("id")),i=this.$(".path.active"),n=this.$("#lessons-course-"+i.data("id"));i.removeClass("active"),n.fastHide(),t.addClass("active"),s.fastShow()},hoverLesson:function(e){"mouseenter"==e.type?$(e.currentTarget).velocity("stop",!0).velocity({scale:[1.02,1]},80,"ease-in"):$(e.currentTarget).velocity("stop",!0).velocity("reverse",50)},hoverButton:function(e){"mouseenter"==e.type?$(e.currentTarget).velocity("stop",!0).velocity({scale:[1.1,1]},150):$(e.currentTarget).velocity("stop",!0).velocity("reverse")}})}),define("oauth/index",["require","registry"],function(e){"use strict";var t=e("registry");return Backbone.View.extend({initialize:function(){var e={tz:jstz.determine().name(),screenWidth:screen.width};$.post("/apiv1/student/auth/oauth-login",e).done(function(e){t.get("user").loginWithData(e.data),window.location.href="/student"}).fail(function(e){e.responseJSON&&e.responseJSON.data.message?this.showError("Uh oh, an error occurred",e.responseJSON.data.message):this.showError("Uh oh, an error occurred",e.responseText)}.bind(this))},showError:function(e,t){$("#title").velocity({opacity:[0,1]},function(){$(this).html(e).velocity({opacity:[1,0]}),$("#message").html(t),$(".loader").fastHide()})}})}),define("shared/analytics",["require"],function(e){"use strict";return{trackEvent:function(e,t,s,i){ga("send","event",e,t,s,i)},trackPage:function(e){ga("send","pageview",e)},customDimension:function(e,t){ga("set","dimension"+e,t)},customMetric:function(e,t){ga("set","metric"+e,t)},trackSale:function(e,t){ga("require","ecommerce"),ga("ecommerce:addTransaction",{id:e.transaction_id,affiliation:e.store,revenue:e.total,shipping:0,tax:0}),t&&t.forEach(function(t){ga("ecommerce:addItem",{id:e.transaction_id,name:t.product,sku:t.sku,category:t.category,price:t.price,quantity:t.quantity||1})}),ga("ecommerce:send")}}}),define("shared/form_validation",["require"],function(e){"use strict";var t=function(e,t,s,i,n,r,o){1==arguments.length?(_.extend(this,arguments[0]),this.bindTo&&this.successCallback&&(this.successCallback=this.successCallback.bind(this.bindTo))):(this.form=e,this.button=t,this.model=s,n&&(i=i.bind(n)),this.successCallback=i||$.noop,this.remainDisabled=r),o&&(s.fileUpload=e),this.setup()};return t.prototype.setup=function(){this.form.validate({submitHandler:_.bind(this.submitHandler,this),rules:this.model.validationRules||{},messages:this.model.validationMessages||{},invalidHandler:function(e,t){var s=t.errorList.map(function(e){return e.element});$.Velocity(s,"ftw.miniShake")}.bind(this)});var e=this;this.button.click(function(t){t.preventDefault(),e.form.submit()})},t.prototype.submitHandler=function(e){if(this.options=e||{delay:300},!this.submitted){this.disableButton();var t={},s=this.model.toJSON();_.each(this.form.serializeArray(),function(e){e.value!=s[e.name]&&(t[e.name]=e.value)}),setTimeout(function(){this.save(t,{patch:!0,silent:!1,wait:!0})}.bind(this),this.options.delay||0)}},t.prototype.saveSuccess=function(e){this.successCallback(e.data,this.model,this.form),this.remainDisabled||this.enableButton()},t.prototype.saveError=function(e){if(e=e||{},$._lastXhr={response:JSON.stringify(e)},"object"==typeof e&&(e=e.responseJSON||e.responseText||e.data),this.failureCallback&&this.failureCallback(e),e){var t=this.model.validationMessages||{};if("object"==typeof e){_.each(e,function(s,i){t[i]&&t[i][s]&&(e[i]=t[i][s])}.bind(this)),this.form.validate().showErrors(e),$.Velocity($(".error",this.form),"ftw.miniShake");var s=Object.keys(e)[0];this.form.find("[name="+s+"]").focus()}else alert("Response from the server was invalid.  Response: "+JSON.stringify(e))}else alert("There was an error communicating with the server: No response was returned.  Please check your internet connection and try again.");this.enableButton()},t.prototype.disableButton=function(){this.button.addClass("pending"),this.submitted=!0},t.prototype.enableButton=function(){this.button.removeClass("pending"),this.submitted=!1},t.prototype.save=function(e,t){this.model.save(e,t).done(function(e){e.success?this.saveSuccess(e):this.saveError(e)}.bind(this)).fail(function(e){var t=e.responseJSON||e.responseText;this.saveError(t)}.bind(this))},t}),define("shared/form_model",["require"],function(e){"use strict";return Backbone.Model.extend({initialize:function(){$.validator.addMethod("alphanum",function(e){return/^[a-zA-Z0-9]+$/.test(e)},"Can only contain letters and numbers")},validationRules:{},validationMessages:{},sync:function(e){if("read"==e||"delete"==e||!this.fileUpload)return Backbone.Model.prototype.sync.apply(this,arguments);var t=this.id?this.urlRoot+"/"+this.id:this.urlRoot,s=this.id?"patch":"post";return $.ajax({url:t,method:"POST",data:new FormData($(this.fileUpload)[0]),dataType:"json",processData:!1,contentType:!1,headers:{"X-HTTP-METHOD-OVERRIDE":s}}).done(function(e){this.set(e.data)}.bind(this))}})}),define("global/models/signup",["require","shared/form_model"],function(e){"use strict";return e("shared/form_model").extend({initialize:function(){},url:"/apiv1/student/auth/signup",defaults:{username:"",password:"",password2:"",email:"",tz:jstz.determine().name()},validationRules:{username:{minlength:4,maxlength:30,username:!0,required:!0,remote:{url:"/apiv1/student/auth/username",type:"post"}},email:{require:!1,email:!0,emailExtended:!0,remote:{url:"/apiv1/student/auth/email",type:"post"}},password:{required:!0,minlength:4,notMatchUsername:!0},password2:{required:!0,minlength:4,equalTo:"#reg-form input[name=password]"}},validationMessages:{username:{remote:"This username already exists. Please try a different username.",EXISTS:"This username already exists. Please try a different username.",minlength:"Username must be at between 4 and 30 characters in length",maxlength:"Username must be at between 4 and 30 characters in length",INVALID_LENGTH:"Username must be at between 4 and 30 characters in length",INVALID_CHARS:"Can only contain letters, numbers, and underscores",INVALID_IP:"Your teacher has restricted access to only specific locations. Your IP address does not match the list of allowed IPs.",NO_MOBILE_ACCESS:"Your teacher has restricted access from small/mobile devices.  Please log in from a computer."},email:{email:"Invalid email address. Keep in mind, your email is optional.",remote:'An account with this email already exists. If you lost your password, you should use the "I forgot my login" feature to recover it.',EXISTS:'An account with this email already exists. If you lost your password, you should use the "I forgot my login" feature to recover it.',INVALID:"Invalid email address, please double check. Keep in mind, your email is optional."},password:{notMatchUsername:"Password can not be the same as your username",NO_MATCH_USERNAME:"Password can not be the same as your username",minlength:"Password must be at least 4 characters long",INVALID_LENGTH:"Password must be at least 4 characters long"},password2:{required:"Please confirm your password",equalTo:"Passwords do not match",NO_MATCH:"Passwords do not match"},section_id:{INVALID:"Invalid Section ID or code"}}})}),define("global/views/signup_form",["require","templates","shared/analytics","registry","shared/form_validation","global/models/signup"],function(e){"use strict";var t=e("templates"),s=e("shared/analytics"),i=e("registry"),n=e("shared/form_validation"),r=e("global/models/signup");return Backbone.View.extend({events:{"keypress #reg-form input":"submitOnEnter"},initialize:function(e){e.template?this.template=e.template:this.template=t("global","signup_form"),e.classes&&(this.classes=e.classes),e.joinCode&&(this.joinCode=e.joinCode),this.model=new r,this.render(),this.form=this.$("#reg-form");var s=this.$("#reg-form .submit");new n({form:this.form,button:s,model:this.model,successCallback:this.successCallback.bind(this),remainDisabled:!0})},render:function(){this.$el.html(this.template({classes:this.classes,joinCode:this.joinCode}))},successCallback:function(e){s.trackPage("/student/signup/success"),i.get("user").loginWithData(e),"r:"==location.hash.substr(1,2)?window.location.href=location.hash.substr(3):window.location.href="/student"},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}})}),define("global/views/modal",["require","templates"],function(e){"use strict";var t=e("templates");return Backbone.View.extend({contentView:null,className:"popup-wrap",events:{"click .close":"hide","click .ok":"ok"},initialize:function(e){if(this.options=e||{},this.template=t("global","modal"),!e||!_.isObject(e.contentView))throw new Error("Cannot create a modal without a contentView");this.contentView=e.contentView,this.listenTo(this.contentView,"complete",function(e){this.trigger("complete",e),this.hide()}),this.render()},render:function(){return this.$el.html(this.template({title:this.options.title,okButton:this.options.okButton,cancelButton:this.options.cancelButton,closeButton:void 0===this.options.closeButton||this.options.closeButton,width:this.options.width||null})).fastHide(),this.contentView.button=this.$(".ok"),this.$(".popup-content").html(this.contentView.render().el),this},ok:function(){return this.contentView.ok(),!1},show:function(){var e;if("fixed"==this.options.position)$("body").append(this.el),e=this.$el;else{var t=$("<div>"),s=this.$el,i=this.$(".popup");i.addClass("popup-absolute"),$("body").append(t),this.setElement(t),t.append(s),t.append(i),i.css({top:$(window).scrollTop()+50,left:$(window).width()/2-i.outerWidth()/2}),e=s}e.velocity("fadeIn",function(){this.$el.find("input[type=text]:eq(0)").focus()}.bind(this))},hide:function(){return this.$el.velocity("fadeOut",this.remove.bind(this)),!1}})}),define("global/views/notice",["require","templates"],function(e){"use strict";var t=e("templates");return Backbone.View.extend({events:{"click span":"close",mouseover:"hover"},initialize:function(e){this.options=e||{},this.template=t("global","notice")},render:function(){var e=$("#notices");return e.length||(e=$('<div id="notices"></div>'),$("#js-content").prepend(e)),this.$el.html(this.template({error:this.options.error,text:this.options.text})).fastHide().appendTo(e),this},close:function(){return clearTimeout(this.timeout),this.$el.velocity("fadeOut",this.remove.bind(this)),!1},show:function(){this.render(),this.$el.velocity("fadeIn"),this.timeout=setTimeout(this.close.bind(this),5e3)},hover:function(){clearTimeout(this.timeout)}})}),define("global/views/alert",["require","templates"],function(e){"use strict";var t=e("templates");return Backbone.View.extend({events:{"click .ok":"close"},initialize:function(e){this.options=e||{},this.options.position="fixed",this.template=t("global","alert")},render:function(){return this.setElement(this.template({title:this.options.title,text:this.options.text,ok:this.options.ok})),this.$el.fastHide(),$("body").append(this.el),this},close:function(){return this.trigger("close"),this.$el.velocity("fadeOut",this.remove.bind(this)),!1},show:function(){return this.render(),this.$el.velocity("fadeIn",function(){this.$el.find("input:eq(0)").focus()}.bind(this)),this}})}),define("global/models/login",["require","shared/form_model"],function(e){"use strict";return e("shared/form_model").extend({url:"/apiv1/student/auth/login",defaults:{username:null,password:null,tz:jstz.determine().name(),screenWidth:screen.width,adb:!1},validationRules:{username:{required:!0},password:{required:!0}},validationMessages:{username:{INVALID_USERNAME:"This username does not exist",CLASS_MIGRATION:"This account has not been migrated",INVALID_IP:"Your teacher has restricted access to only specific locations. Your IP address does not match the list of allowed IPs.",NO_MOBILE_ACCESS:"Your teacher has restricted access from small/mobile devices.  Please log in from a computer."},password:{INCORRECT_PASSWORD:"Your password is incorrect for this username, please try again"}}})}),define("global/views/forgot_password",["require","templates","shared/form_model","shared/form_validation"],function(e){"use strict";var t=e("templates"),s=e("shared/form_model"),i=e("shared/form_validation"),n=s.extend({url:"/apiv1/student/auth/password-reset",defaults:{email:""},validationRules:{email:{email:!0,emailExtended:!0,required:!0}}});return Backbone.View.extend({events:{"keypress input":"submitOnEnter"},baseModel:null,initialize:function(e){this.options=e,this.template=t("global","forgot_password"),this.templateNoMigrate=t("global","forgot_password_no_migration"),this.model=new n},render:function(){return this.$el.html(this.template({})),this.form=this.$("form"),new i({form:this.form,button:this.button,model:this.model,successCallback:this.successCallback.bind(this),failureCallback:this.failureCallback.bind(this),bindTo:this,remainDisabled:!0}),this},ok:function(){this.notMigrated?location.href="https://classic.typing.com/tutor/":this.form.submit()},successCallback:function(e){this.trigger("complete",e)},failureCallback:function(e){e&&"NOT_MIGRATED"==e.email&&(this.notMigrated=!0,this.$el.html(this.templateNoMigrate()))},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}})}),define("global/views/login_form",["require","templates","registry","shared/form_validation","global/views/modal","global/views/notice","global/views/alert","global/models/login","global/views/forgot_password"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/form_validation"),n=e("global/views/modal"),r=e("global/views/notice"),o=e("global/views/alert"),a=e("global/models/login"),l=e("global/views/forgot_password");return Backbone.View.extend({events:{"keypress #login-form input":"submitOnEnter","click .forgot-password-callout":"forgotPassword"},initialize:function(){this.template=t("global","login_form"),this.model=new a,this.render(),this.form=this.$("#login-form");var e=this.$("#login-form .submit");new i({form:this.form,button:e,model:this.model,failureCallback:this.failureCallback.bind(this),successCallback:this.successCallback.bind(this),remainDisabled:!0})},render:function(){var e=location.hash.replace("#","")||"";"r:"==e.substr(0,2)&&(e=""),this.$el.html(this.template({username:e}))},successCallback:function(e){s.get("user").loginWithData(e),"r:"==location.hash.substr(1,2)?window.location.href=location.hash.substr(3):window.location.href="/student"},failureCallback:function(e){e&&"CLASS_MIGRATION"==e.username&&new o({title:"Oh no!",text:'Your teacher has not yet migrated to the new version of Typing.com.</p><p>To continue your lessons, please go to <a href="http://classic.typing.com/tutor/">http://classic.typing.com/tutor</a> and log in.'}).show()},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())},forgotPassword:function(){var e=new n({title:"I forgot my login!",okButton:"Continue",cancelButton:"Cancel",contentView:new l,width:500});return e.on("complete",function(e){e&&e.bounce?new r({error:!0,text:"An email has been sent with instructions for changing your password.<br /><br />However, the last email we sent you was undeliverable. Your mail service returned the error: "+e.bounce+"<br /><br />Because of this, it is possible you will not receive this email."}).show():new r({error:!1,text:"An email has been sent with instructions for changing your password."}).show()}.bind(this)),e.show(),!1}})}),define("global/views/login",["require","templates","global/views/signup_form","global/views/login_form"],function(e){"use strict";var t=e("templates"),s=e("global/views/signup_form"),i=e("global/views/login_form");return Backbone.View.extend({events:{"click #cleverLogin":"cleverLogin","click #googleLogin":"googleLogin"},initialize:function(e){this.options=e||{},void 0===this.template&&(this.template=t("global","login")),this.render(),new s({el:this.$("#signupContent")}),new i({el:this.$("#loginContent")}),this.focus()},render:function(){return this.$el.html(this.template({hideTeacherCallout:this.options.hideTeacherCallout})),this},focus:function(){"/student/signup"==location.pathname?$("#reg-form input[name=username]").focus():$("#login-form input[name=username]").focus()},getState:function(){var e=_.random(1e4,99999);return $.cookie("state",e,{path:"/"}),e},cleverLogin:function(){return location.href="https://clever.com/oauth/authorize?client_id="+FTWGLOBALS("cleverClientId")+"&redirect_uri="+encodeURIComponent(FTWGLOBALS("cleverRedirectUri"))+"&response_type=code&state="+this.getState(),!1},googleLogin:function(){return location.href="https://accounts.google.com/o/oauth2/auth?client_id="+FTWGLOBALS("googleClientId")+"&redirect_uri="+encodeURIComponent(FTWGLOBALS("googleRedirectUri"))+"&response_type=code&fetch_basic_profile=true&scope=openid%20email%20profile&state="+this.getState(),!1}})}),define("index/login",["require","global/views/login"],function(e){"use strict";var t=e("global/views/login");return Backbone.View.extend({el:"#js-content",initialize:function(){new t({el:this.el})}})}),define("join/views/classes_modal",["require","templates"],function(e){"use strict";var t=e("templates");return Backbone.View.extend({initialize:function(e){this.options=e,this.template=t("join","classes_modal")},render:function(){return this.$el.html(this.template({classes:this.options.classes})),this},ok:function(){this.successCallback()},successCallback:function(){this.trigger("complete",this.$("select[name=section_id]").val())}})}),define("join/index",["require","templates","global/views/signup_form","global/views/modal","join/views/classes_modal"],function(e){"use strict";var t=e("templates"),s=e("global/views/signup_form"),i=e("global/views/modal"),n=e("join/views/classes_modal");return Backbone.View.extend({el:"#js-content",events:{"click #cleverLogin":"cleverLogin","click #googleLogin":"googleLogin"},initialize:function(e){this.options=e,this.template=t("join","index"),this.formTemplate=t("join","form"),this.failedTemplate=t("join","failed"),$.post("/apiv1/student/auth/join-validate",{join_code:e.code}).done(function(e){this.classes=e.data,this.render()}.bind(this)).fail(this.renderFailed.bind(this))},render:function(){this.$el.html(this.template()),new s({el:this.$("#signupContent"),template:this.formTemplate,classes:this.classes,joinCode:this.options.code})},renderFailed:function(){this.$el.html(this.failedTemplate())},getState:function(){var e=_.random(1e4,99999);return $.cookie("state",e,{path:"/"}),e},cleverLogin:function(){return location.href="https://clever.com/oauth/authorize?client_id="+FTWGLOBALS("cleverClientId")+"&redirect_uri="+encodeURIComponent(FTWGLOBALS("cleverRedirectUri"))+"&response_type=code&state="+this.getState(),!1},googleLogin:function(){if($.cookie("_joinCode",this.options.code,{path:"/"}),1==this.classes.length)return $.cookie("_joinClassId",this.classes[0].section_id,{path:"/"}),this.completeGoogleLogin();var e=new i({width:450,title:"Select Your Class",okButton:"Continue",cancelButton:"Cancel",contentView:new n({classes:this.classes})});return e.on("complete",function(t){$.cookie("_joinClassId",t,{path:"/"}),e.hide(),this.completeGoogleLogin()}.bind(this)),e.show(),!1},completeGoogleLogin:function(){return location.href="https://accounts.google.com/o/oauth2/auth?client_id="+FTWGLOBALS("googleClientId")+"&redirect_uri="+encodeURIComponent(FTWGLOBALS("googleRedirectUri"))+"&response_type=code&scope=openid&state="+this.getState(),!1}})}),define("password/index",["require","templates","shared/form_model","shared/form_validation","global/views/notice"],function(e){"use strict";var t=e("templates"),s=e("shared/form_model"),i=e("shared/form_validation"),n=(e("global/views/notice"),s.extend({initialize:function(){},url:"/apiv1/student/auth/password-update",defaults:{hash:"",user_id:"",username:"",password:"",password2:""},validationRules:{password:{required:!0,minlength:4},password2:{required:!0,minlength:4,equalTo:"#password-form input[name=password]"}},validationMessages:{password:{required:"Please enter a password"},password2:{required:"Please confirm your password",equalTo:"Passwords do not match"}}})),r=Backbone.View.extend({events:{"keypress #password-form input":"submitOnEnter"},initialize:function(e){this.model=new n(e.data),this.form=this.$("#password-form");var t=this.$("#password-form .submit");new i(this.form,t,this.model,this.successCallback,this,!0)},successCallback:function(e){this.trigger("complete")},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}});return Backbone.View.extend({el:"#js-content",initialize:function(e){this.options=e||{},this.template=t("password","index"),this.failedTemplate=t("password","failed"),this.completeTemplate=t("password","complete");var s=location.hash.replace("#","").split("!"),i=s[0],n=s[1];$.post("/apiv1/student/auth/password-validate",{hash:i,user_id:n}).done(function(e){this.data={username:e.data.username,hash:i,user_id:n},this.render()}.bind(this)).fail(this.renderFailed.bind(this))},render:function(){return this.$el.html(this.template(this.data)),new r({el:this.el,data:this.data}).on("complete",this.renderComplete.bind(this)),this.$("#password-form input[name=password]").focus(),this},renderFailed:function(){this.$el.html(this.failedTemplate())},renderComplete:function(){this.$el.velocity("slideUp",function(){this.$el.html(this.completeTemplate()).velocity("slideDown")}.bind(this))}})}),define("scoreboard/collections/scoreboard",["require","shared/scoring"],function(e){"use strict";var t=e("shared/scoring");return Backbone.Collection.extend({model:Backbone.Model.extend({idAttribute:"user_id"}),url:"/apiv1/student/scoreboard",parse:function(e){var s=e.data;return _.isArray(s)&&s.forEach(function(e){e.speed=t.speed(e.typed,e.seconds,e.errors),e.accuracy=t.accuracy(e.typed,e.errors)}),Backbone.Collection.prototype.parse.call(this,e)},comparatorKey:"speed",comparator:function(e){return-e.get(this.comparatorKey)}})}),define("scoreboard/index",["require","templates","registry","scoreboard/collections/scoreboard"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("scoreboard/collections/scoreboard");return Backbone.View.extend({el:"#js-content",events:{"click .type":"changeType"},initialize:function(){this.template=t("scoreboard","index"),this.collection=new i,this.collection.fetch({reset:!0}),this.listenTo(this.collection,"reset",this.render),this.user=s.get("user")},render:function(){this.$el.html(this.template({type:this.collection.comparatorKey,data:this.collection.toJSON()}))},changeType:function(e){var t=$(e.currentTarget);return!t.hasClass("active")&&(this.collection.comparatorKey=t.data("id"),this.collection.sort(),this.render(),!1)}})}),define("verify/models/test",["require","shared/form_model"],function(e){"use strict";return e("shared/form_model").extend({idAttribute:"user_test_id",url:function(){return"/apiv1/student/tests/"+this.id+"/verify?user_id="+this.get("user_id")}})}),define("verify/index",["require","templates","registry","verify/models/test"],function(e){"use strict";var t=e("templates"),s=(e("registry"),e("verify/models/test"));return Backbone.View.extend({el:"#js-content",initialize:function(e){this.template=t("verify","index"),this.model=new s(e),this.model.fetch().done(this.render.bind(this))},render:function(e){this.$el.html(this.template({data:this.model.toJSON()}))}})}),define("shared/radar_tracker",["require"],function(e){"use strict";return{track:function(e,t){if(e.get("teacher_id")){var s={t:e.get("teacher_id"),u:e.id};t&&(s.l={t:t.typed,s:t.seconds,e:t.errors,p:t.progress}),$.get("/apiv1/student/radar/"+window.btoa(JSON.stringify(s)))}}}}),define("lessons/models/screen",["require"],function(e){"use strict";return Backbone.Model.extend({idAttribute:"lesson_screen_id",defaults:{content:"",formatted_content:"",lastKey:"",line:0,typed:0,errors:0,seconds:0,lastKeyCode:0,lastKeyError:!1},formatContent:function(e,t){var s=this.get("content"),i=this.get("title"),n=this.get("intro");s=s.replace(/\r/g,"").replace(/\s+\n/g,"\n").trim(),"speed"==this.get("screen_type")&&(s=s+"\n"+s+"\n"+s+"\n"+s+"\n");var r=s=this.periodSpacing(s,t.get("spaces"));s=s.replace(/⏎\n/g,"⏎"),this.set({title:i,intro:n,content:s,formatted_content:r})},getContentByLine:function(){return _.compact(this.get("formatted_content").split(/\n/)).map(function(e,t,s){return e=e.split(""),t<s.length&&"⏎"!=e[e.length-1]&&e.push("\n"),e})},charAt:function(e){return(this.get("content")||"")[e]},handleInput:function(e){var t=this.get("typed"),s=this.get("screen_type"),i=this.get("errors"),n=this.get("line"),r=t,o=e.key,a=this.charAt(r),l="\n"==a||"⏎"==a,c=!1;if("\n"==a&&" "==o&&"speed"!=s&&(a=" "),"⏎"==a&&"\n"==o&&(a="\n"),!(r>=this.get("content").length)){if("BACKSPACE"==o){if("falling"==s)return;if("speed"==s&&("\n"==this.charAt(r-1)||"⏎"==this.charAt(r-1)))return;"\n"!=this.charAt(r-1)&&"⏎"!=this.charAt(r-1)||n--,r>0&&(r-=1)}else{if(e.special)return;a==o?(r+=1,l&&n++):a!=o&&(c=!0,this.get("lastKeyError")||(r+="falling"==this.get("screen_type")?0:1,i+=1,l&&n++))}this.set({typed:r,nextKey:this.charAt(r),letterTyped:o,lastKeyError:c,errors:i,correctLetter:a,line:n}),r>=this.get("content").length&&this.trigger("complete")}},periodSpacing:function(e,t){if((t=t||1)<1||t>2)throw new Error("Only 1 or 2 spaces after a period");var s=1==t?" ":"  ";return e.replace(/(\.|\?|!) +/g,"$1"+s).replace(/(mrs\.|mr\.|sr\.|st\.|ms\.|\s\w\.|inc\.|lt\.|jr\.|dr\.|\sgt\.|ft\.|st\.|ave\.|rd\.|in\.|hrs\.|e\.g\.|ot\.|lol\.|ed\.|fl\.|off\.|ord\.|rt\.|rds\.|asstd\.|ea\.|ltd\.|ins\.|reg\.|c\.o\.d\.)  /gi,"$1 ")},metMinimums:function(e,t){return!(e>0&&this.speed()<e)&&!(t>0&&this.accuracy()<t)},quickComplete:function(){this.set({typed:1}),this.trigger("complete")},setPeriodSpacing:function(e){this.set({content:this.periodSpacing(this.get("content"),e),period_spacing:e})}})}),define("lessons/collections/screens",["require","lessons/models/screen"],function(e){"use strict";var t=e("lessons/models/screen");return Backbone.Collection.extend({model:t,comparator:"display_order"})}),define("lessons/collections/problemkey_screens",["require","lessons/models/screen"],function(e){"use strict";var t=e("lessons/models/screen");return Backbone.Collection.extend({constructor:function(e,t){for(var s=t.letters.map(function(e){return e.id.toUpperCase()}),i=_.shuffle(_.flatten(_.map(s,function(e){return t.words[e]}))),n=[],r=0,o=0;;){for(n[r]||(n[r]="");;){if((n[r]+" "+i[o]).length>=50){n[r]=n[r].trim(),r++;break}n[r]+=" "+i[o],o++}if(r>100)break}return e[0].intro=e[0].intro.format(s.join(", ")),e[0].title+=s.join(", "),e[0].content=n.join("\n"),Backbone.Collection.call(this,e,t)},model:t,comparator:"display_order"})}),define("lessons/views/nav",["require","templates"],function(e){"use strict";var t=e("templates");return Backbone.View.extend({initialize:function(e){void 0===this.template&&(this.template=t("lessons","nav")),this.lesson=e.lesson,this.screen=e.screen},render:function(){return this.$el.html(this.template({lesson:this.lesson.toJSON(),screen:this.screen?this.screen.toJSON():{}})),this}})}),define("global/views/keyboard",["require","templates","registry"],function(e){"use strict";var t=e("templates"),s=e("registry");return Backbone.View.extend({highlighted:[],lastFingers:[],events:{"click .hide-keyboard":"toggle"},initialize:function(e){void 0===this.template&&(this.template=t("global","keyboard")),this.user=s.get("user"),this.setKeyboard(e)},setKeyboard:function(e){return this.options=e||{type:"small",noHands:!1,noControls:!1},e.model&&(this.model=e.model),this},toggleCapsLockWarning:function(e){this.capsLockWarning&&(e&&this.capsLockWarning.is(":hidden")?this.capsLockWarning.velocity("fadeIn"):!e&&this.capsLockWarning.is(":visible")&&this.capsLockWarning.velocity("fadeOut"))},render:function(){return this.$el.html(this.template({format:this.model.get("type"),structure:this.model.get("structure"),type:this.options.type,noHands:this.options.noHands,noControls:this.options.noControls,hideKeyboard:this.user.get("hideKeyboard")})),"large"==this.options.type&&(this.hands=this.$("#handsImg")[0]),this.capsLockWarning=this.$(".capslock-warning"),this},highlightKey:function(e){"\n"==(e=e||"")&&(e="⏎");var t,s,i="⏎"==e?13:e.toLowerCase().charCodeAt(0),n=this.$(".key-"+i),r=e!=e.toLowerCase()||n.data("shifted")==i,o=n.data("finger");r&&(o<=5?(t=this.rightCaps||this.$(".key-16.right"),this.rightCaps=t):(t=this.leftCaps||this.$(".key-16.left"),this.leftCaps=t)),this.highlighted.forEach(function(e){e[0].classList.remove("active")}),this.highlighted=[],"small"==this.options.type?(this.lastFingers.forEach(function(e){this.el.classList.remove("finger-"+e)}.bind(this)),this.lastFingers=[]):(this.lastFingers.forEach(function(e){e.setAttribute("class",e.className.baseVal.replace("is-active",""))}),this.lastFingers=[]),e&&(o&&("small"==this.options.type?(this.$el[0].classList.add("finger-"+o),this.lastFingers.push(o),r&&(o<=5?(this.$el[0].classList.add("finger-10"),this.lastFingers.push(10)):(this.$el[0].classList.add("finger-1"),this.lastFingers.push(1)))):(s=this.hands.querySelector("path.finger-"+o),this.lastFingers.push(s),s.setAttribute("class",s.className.baseVal+" is-active"),r&&(s=o<=5?this.hands.querySelector("path.finger-10"):this.hands.querySelector("path.finger-1"),this.lastFingers.push(s),s.setAttribute("class",s.className.baseVal+" is-active")))),r&&(this.highlighted.push(t),t[0].classList.add("active")),n.length&&(this.highlighted.push(n),n[0].classList.add("active")))},toggle:function(){this.$(".keyboard-container").toggleClass("hidden"),this.user.set({hideKeyboard:this.$(".keyboard-container").hasClass("hidden")})}})}),define("lessons/views/intro",["require","templates","global/views/keyboard"],function(e){"use strict";var t=e("templates"),s=e("global/views/keyboard");return Backbone.View.extend({events:{"click .begin-button":"begin"},animatedKeyId:0,animationSpeed:1e3,initialize:function(e){this.options=e,void 0===this.template&&(this.template=t("lessons",this.options.test?"test_intro":"intro")),e.contents.match("virtual-keyboard")&&(this.keyboard=new s({type:29==e.keyboard.id?"small":"large",noControls:!0,model:e.keyboard})),this.input=e.input},render:function(){if(this.listenTo(this.input,"keypress",this.handleKeypress),this.$el.html(this.template({contents:this.options.contents})),this.keyboard){var e=this.$(".virtual-keyboard");29==this.options.keyboard&&(this.keyboard.type="small"),this.animationSpeed=e.data("keys-speed")||1e3,this.keysToAnimate=String(e.data("keys")).split(" ").map(function(e){return"space"==e?" ":"quote"==e?'"':e}),e.html(this.keyboard.render().el),this.animateKeys()}return this},begin:function(){return this.trigger("begin"),!1},handleKeypress:function(e){"\n"==e.key&&this.begin()},animateKeys:function(){this.animatedKeyId>=this.keysToAnimate.length&&(this.animatedKeyId=0),this.keyboard.highlightKey(this.keysToAnimate[this.animatedKeyId]),this.animatedKeyId++,this.animationTimeout=setTimeout(this.animateKeys.bind(this),this.animationSpeed)},hide:function(){this.stopListening(this.input),clearTimeout(this.animationTimeout),this.$("#handsImg").remove(),this.$el.fastHide()}})}),define("lessons/views/congrats",["require","templates","shared/scoring","registry","global/collections/badges","global/collections/courses","global/collections/lessons"],function(e){"use strict";var t=e("templates"),s=e("shared/scoring"),i=e("registry"),n=e("global/collections/badges"),r=e("global/collections/courses"),o=e("global/collections/lessons");return Backbone.View.extend({initialize:function(e){void 0===this.template&&(this.template=t("lessons","congrats")),this.userLessons=i.get("userLessons"),this.lessons=new o(FTWGLOBALS("lessons")),this.courses=new r(FTWGLOBALS("courses")),this.badges=new n,this.screen=e.screen,this.userLesson=e.userLesson,this.userLessonScreens=e.userLessonScreens,this.lesson=e.lesson},render:function(){this.lessons.setProgress(this.userLessons),this.courses.setProgress(this.lessons);var e=this.courses.get(this.lesson.get("course")).get("active_lesson"),t=this.lessons.get(e),i=[];return this.userLessonScreens.forEach(function(e){for(var t=e.get("stars"),s=0;s<t;s++)i.push(1);for(s=0;s<3-t;s++)i.push(0)}),this.$el.html(this.template({lesson:this.lesson.toJSON(),starList:i,stars:this.userLesson.get("stars"),totalStars:3*this.lesson.get("screens"),accuracy:s.accuracy(this.userLesson.get("typed"),this.userLesson.get("errors")),speed:s.speed(this.userLesson.get("typed"),this.userLesson.get("seconds"),this.userLesson.get("errors")),time:(this.userLesson.get("seconds")||0).countdownSeconds(),activeLesson:t?t.toJSON():null,badge:this.badges.get(this.lesson.get("badge")||1).get("template")})),this}})}),define("lessons/views/screen_complete",["require","templates","registry","shared/scoring"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/scoring");return Backbone.View.extend({saved:!1,events:{"click .continue-button":"continue","click .try-again":"restart","click .saving-failed a":"saveTryAgain"},initialize:function(e){void 0===this.template&&(this.template=t("lessons","screen_complete")),this.user=s.get("user"),this.screen=e.screen,this.screenType=e.screenType,this.userLesson=e.userLesson,this.userLessonScreens=e.userLessonScreens,this.lesson=e.lesson,this.lettersTyped=e.lettersTyped,this.input=e.input,this.typingView=e.typingView,this.problemKeysLesson=e.problemKeysLesson},render:function(){this.listenTo(this.input,"keypress",this.handleKeyPress);var e=i.accuracy(this.screen.get("typed"),this.screen.get("errors")),t=0,s=0,n=0;this.userLesson.get("progress")>0&&(t=i.accuracy(this.userLesson.get("typed")+this.screen.get("typed"),this.userLesson.get("errors")+this.screen.get("errors")),s=i.speed(this.userLesson.get("typed")+this.screen.get("typed"),this.userLesson.get("seconds")+this.screen.get("seconds"),this.userLesson.get("errors")+this.screen.get("errors")),n=(this.userLesson.get("seconds")+this.screen.get("seconds")||0).countdownSeconds()),this.$el.html(this.template({loggedIn:FTWGLOBALS("loggedIn"),lesson:this.lesson.toJSON(),two_stars:this.user.get("two_stars"),three_stars:this.user.get("three_stars"),stars:i.stars(e,this.user.get("two_stars"),this.user.get("three_stars")),accuracy:0,speed:0,problemKeys:_.pluck(this.lettersTyped.topProblemKeys(3),"id"),time:0,lessonAccuracy:t,lessonSpeed:s,lessonTime:n,screenType:this.screenType,problemKeysLesson:this.problemKeysLesson,lineSpeeds:this.calculateLineSpeeds()}));var r=this.$(".stars span").css({visibility:"hidden"}),o="easeOutQuint";$.Velocity(r[0],{opacity:[1,0],rotateZ:["-5deg",0],scale:[1,15]},{delay:600,display:"inline-block",visibility:"visible",duration:1e3,easing:o}),$.Velocity(r[1],{opacity:[1,0],scale:[1.2,15]},{delay:800,display:"inline-block",visibility:"visible",duration:1e3,easing:o}),$.Velocity(r[2],{opacity:[1,0],rotateZ:["5deg",0],scale:[1,15]},{delay:1e3,display:"inline-block",visibility:"visible",duration:1e3,easing:o});var a=function(){this.$("#screen-time").countdown([this.screen.get("seconds")||0,0],{formatter:function(e){return e.countdownSeconds()}},500)}.bind(this),l=function(){this.$("#screen-accuracy").countdown([e,0],null,500,a)}.bind(this);return this.$("#screen-speed").countdown([i.speed(this.screen.get("typed"),this.screen.get("seconds"),this.screen.get("errors")),0],null,500,l),this},continue:function(){return!!this.saved&&(this.$(".continue-button").addClass("pending"),this.trigger("continue"),location.softReload(),!1)},restart:function(){return this.saved&&this.userLesson.inc({progress:-1}),location.href=location.href,!1},handleKeyPress:function(e){"\n"==e.key&&this.continue()},showSaved:function(){this.saved=!0,this.$(".saving-spinner").hide(),this.$(".saving-failed").hide(),this.$(".continue-button").show()},showSaveError:function(){this.$(".saving-spinner").hide(),this.$(".saving-failed").show()},saveTryAgain:function(){return this.$(".saving-failed").hide(),this.$(".saving-spinner").show(),this.trigger("try-again"),!1},calculateLineSpeeds:function(){var e=[];return"speed"==this.screenType&&this.typingView.lineScores.forEach(function(t,s){var n=i.speed(t.typed,t.seconds,t.errors),r=0;s>0&&(r=i.speed(this.typingView.lineScores[s-1].typed,this.typingView.lineScores[s-1].seconds,this.typingView.lineScores[s-1].errors)),e[s]={speed:n,improvement:r>0?Math.round((n-r)/r*100):0}}.bind(this)),e}})}),define("lessons/views/screen_failed",["require","templates","shared/scoring"],function(e){"use strict";var t=e("templates"),s=e("shared/scoring");return Backbone.View.extend({saved:!1,events:{"click .continue-button":"restart"},initialize:function(e){void 0===this.template&&(this.template=t("lessons","screen_failed")),this.screen=e.screen,this.screenType=e.screenType,this.userLesson=e.userLesson,this.userLessonScreens=e.userLessonScreens,this.lesson=e.lesson,this.lettersTyped=e.lettersTyped,this.input=e.input,this.typingView=e.typingView},render:function(){this.listenTo(this.input,"keypress",this.handleKeyPress);var e=s.accuracy(this.screen.get("typed"),this.screen.get("errors"));return this.$el.html(this.template({lesson:this.lesson.toJSON(),accuracy:e,speed:s.speed(this.screen.get("typed"),this.screen.get("seconds"),this.screen.get("errors")),problemKeys:_.pluck(this.lettersTyped.topProblemKeys(3),"id"),time:(parseInt(this.screen.get("seconds"))||0).countdownSeconds(),screenType:this.screenType})),this},restart:function(){return location.softReload(),!1},handleKeyPress:function(e){"\n"==e.key&&this.restart()}})}),define("test/views/name_modal",["require","templates","shared/form_model","registry","shared/form_validation"],function(e){"use strict";var t=e("templates"),s=e("shared/form_model"),i=e("registry"),n=e("shared/form_validation"),r=s.extend({url:"/apiv1/student/user/account",defaults:{first_name:"",last_name:""},validationRules:{first_name:{required:!0},last_name:{required:!0}},validationMessages:{}});return Backbone.View.extend({events:{"keypress input":"submitOnEnter"},baseModel:null,initialize:function(e){this.options=e,this.template=t("test","name_modal"),this.model=new r},render:function(){return this.$el.html(this.template({})),this.form=this.$("form"),new n(this.form,this.button,this.model,this.successCallback,this),this},ok:function(){this.form.submit()},successCallback:function(e){i.get("user").set(e),this.trigger("complete")},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}})}),define("lessons/views/test_complete",["require","templates","shared/scoring","registry","global/views/notice","global/views/modal","test/views/name_modal","lessons/views/screen_complete"],function(e){"use strict";var t=e("templates"),s=(e("shared/scoring"),e("registry")),i=e("global/views/notice"),n=e("global/views/modal"),r=e("test/views/name_modal"),o=e("lessons/views/screen_complete");return o.extend({initialize:function(e){o.prototype.initialize.apply(this,arguments),this.template=t("lessons","test_complete"),this.user=s.get("user")},render:function(){return o.prototype.render.apply(this,arguments),this},continue:function(){if(!this.saved)return!1;var e=this.userLesson.get("last_save_response").id;return this.user.get("first_name")||this.user.get("last_name")?window.open("/apiv1/student/tests/"+e+"/certificate"):this.requestName(),!1},restart:function(){return location.softReload(),!1},requestName:function(){var e=new n({title:"Enter Your Name",okButton:"Continue",cancelButton:"Cancel",contentView:new r,width:500});return e.on("complete",function(){new i({error:!1,text:"Your name has been updated. You may now print your certificate."}).show()}.bind(this)),e.show(),!1},handleKeyPress:function(e){return!1}})}),define("lessons/views/progress",["require","templates","shared/scoring"],function(e){"use strict";var t=e("templates"),s=e("shared/scoring");return Backbone.View.extend({events:{"mouseover .progress-screens span":"showDetails","mouseout .progress-screens span":"hideDetails","click .progress-screens span":"goToScreen"},initialize:function(e){void 0===this.template&&(this.template=t("lessons","progress"),this.hoverTemplate=t("lessons","progress_hover")),this.userLesson=e.userLesson,this.userLessonScreens=e.userLessonScreens,this.lesson=e.lesson,this.screens=e.screens},render:function(){return this.$el.html(this.template({lesson:this.lesson.toJSON(),screens:this.screens.toJSON(),userLesson:this.userLesson.toJSON(),userLessonScreens:this.userLessonScreens})),this.hover=this.$("#progressHover"),this},goToScreen:function(e){var t=$(e.currentTarget).data("id"),s=this.screens.indexOf(this.screens.get(t));s<=this.userLessonScreens.length&&(this.userLesson.set({progress:s}),location.softReload())},showDetails:function(e){var t=$(e.currentTarget),i=t.data("id"),n=t.width(),r=t.position().left,o=this.screens.get(i),a=this.userLessonScreens.get(i),l=0,c=0,d=0,h=!1;a&&(l=a.get("stars"),c=s.speed(a.get("typed"),a.get("seconds"),a.get("errors")),d=s.accuracy(a.get("typed"),a.get("errors")),h=!0),this.hover.css({left:r+n/2-100+20-4}).html(this.hoverTemplate({title:o.get("title"),stars:l,speed:c,accuracy:d,completed:h})).velocity("stop",!0).velocity("ftw.perspectiveShake",{display:"block"})},hideDetails:function(e){return!$(e.relatedTarget).parent().hasClass("progress-screens")&&(this.hover.fastHide(),!1)}})}),define("shared/sounds",["require"],function(e){"use strict";return{sounds:{},play:function(e){"string"==typeof e&&(e={id:e}),e.loop=e.loop||!1,e.volume=e.volume||1,e.delay=e.delay||0,this.sounds[e.id]&&(this.sounds[e.id].volume=e.volume,this.sounds[e.id].loop=e.loop,setTimeout(function(){try{this.sounds[e.id].play()}catch(e){}}.bind(this),e.delay))},stop:function(e,t){var s=this.sounds[e];s&&(s.pause(),s.currentTime=0)},preload:function(e,t,s){t=t||"/dist/site/images/sounds/",s=s||e;try{this.sounds[e]=new Audio(t+s+".mp3")}catch(e){}}}}),define("shared/tooltip",["require","templates"],function(e){"use strict";e("templates");return new(Backbone.View.extend({className:"tooltip",initialize:function(){$("body").append(this.$el)},init:function(){$(".tooltip-trigger").off("mouseover.tooltip").off("mouseout.tooltip").on("mouseover.tooltip",function(e){this.show(e.currentTarget,$(e.currentTarget).data("tooltip"))}.bind(this)).on("mouseout.tooltip",function(){this.hide()}.bind(this))},show:function(e,t){e=$(e),this.$el.html(t).css({left:e.offset().left-this.$el.outerWidth()/2+e.outerWidth()/2-3,top:e.offset().top-this.$el.outerHeight()-10}),this.$el.velocity("ftw.growUp",{display:"block"})},hide:function(){this.$el.fastHide()}}))}),define("lessons/views/typing",["require","templates","registry","shared/sounds","shared/scoring","shared/tooltip","global/views/keyboard"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/sounds"),n=(e("shared/scoring"),e("shared/tooltip")),r=e("global/views/keyboard");return Backbone.View.extend({keyboardType:null,templateName:null,lettersCache:null,activeLetter:null,events:{"click .button-restart":"restart"},initialize:function(e){void 0===this.template&&(this.baseTemplate=t("lessons","typing"),this.template=t("lessons",this.templateName)),this.lettersTyped=e.lettersTyped,this.user=s.get("user"),this.input=e.input,this.timer=e.timer,this.keyboardType&&(this.keyboard=new r({type:this.keyboardType,model:e.keyboard}),this.input.on("capslock",this.keyboard.toggleCapsLockWarning.bind(this.keyboard))),i.preload("error"),this.userLesson=e.userLesson,this.userLessonScreens=e.userLessonScreens,this.lesson=e.lesson,this.screens=e.screens,this.screen=e.screen,this.screen.on("change:typed",this.handleKeyTyped,this),this.screen.on("change:errors",this.handleErrorTyped,this),this.screen.once("complete",this.handleComplete.bind(this))},render:function(){return n.hide(),this.$el.html(this.baseTemplate()),this.listenTo(this.input,"keypress",this.handleInput),this.keyboard&&(this.$("#keyboard-content").append(this.keyboard.render().el),this.keyboard.highlightKey(this.screen.charAt(0))),s.get("isMobile")&&"software"==this.user.get("_mobileKeyboard")&&$("#ios-overlay").fastShow(),this.setPosition(0),this},handleComplete:function(){this.screen.off("complete",this.handleComplete.bind(this)),this.timer.stop();var e=-1;this.keyTimes.length>20&&(e=Math.round(this.std(this.keyTimes))),this.screen.set({seconds:this.timer.get("seconds"),std:e}),this.trigger("complete"),n.init()},startCursorAnimation:function(){s.get("userActivity").length<=1&&0===this.userLesson.get("progress")&&(this.startCursorTimeout=setTimeout(function(){n.show(this.$(".letter.active"),"Start Typing!")}.bind(this),3e3))},stopCursorAnimation:function(){clearTimeout(this.startCursorTimeout),n.hide()},keyTimes:[],lastKeyTime:0,handleInput:function(e){if(this.lastKeyTime){var t=Date.now();this.keyTimes.push(Date.now()-this.lastKeyTime),this.lastKeyTime=t}0===this.screen.get("typed")&&(this.timer.start(),this.lastKeyTime=Date.now(),this.stopCursorAnimation()),"NEXT"==e.key?(this.timer.stop().set({seconds:10}),this.screen.quickComplete()):this.screen.handleInput(e)},handleKeyTyped:function(e){e.changed.lastKeyError?this.lettersTyped.trackError(e.get("correctLetter")):this.lettersTyped.trackCorrect(e.get("letterTyped")),this.keyboard&&this.keyboard.highlightKey(e.get("nextKey")),this.setPosition(e.changed.typed,e.get("lastKeyError"))},restart:function(){return location.softReload(),!1},handleErrorTyped:function(e){if(this.activeLetter){var t=$("<div>").addClass("error-letter").css({color:"red"}).html(e.get("letterTyped"));this.$(this.activeLetter).prev().append(t),t.velocity("transition.slideDownOut")}i.play("error")},setPosition:function(e,t){if(!this.lettersCache){var s=this.$(".screen span");if(0===s.length)return;this.lettersCache=s}var i=e-1>=0?this.lettersCache[e-1]:null,n=this.lettersCache[e]||null,r=this.lettersCache.length>e+1?this.lettersCache[e+1]:null;n&&(n.classList.add("active"),n.classList.remove("error"),n.classList.remove("typed"),this.activeLetter=n),r&&(r.classList.remove("error"),r.classList.remove("typed"),r.classList.remove("active")),i&&e>0&&(i.classList.remove("active"),i.classList.add("typed"),t&&i.classList.add("error"))},hide:function(){this.stopListening(this.input),this.remove()},std:function(e){e.sort(function(e,t){return e-t}),e.pop(),e.pop(),e.pop(),e.pop(),e.shift(),e.shift(),e.shift(),e.shift();var t=function(e){return e.reduce(function(e,t){return e+t},0)/e.length},s=t(e),i=t(e.map(function(e){var t=e-s;return t*t}));return Math.sqrt(i)}})}),define("lessons/views/typing_standard",["require","templates","registry","lessons/views/typing"],function(e){"use strict";e("templates");var t=e("registry"),s=e("lessons/views/typing");return s.extend({keyboardType:"small",templateName:"typing_standard",initialize:function(e){return s.prototype.initialize.call(this,e)},render:function(){return s.prototype.render.call(this),this.$("#lesson-content").append(this.template({minimumLines:4,lesson:this.lesson.toJSON(),typingContent:this.screen.getContentByLine(),user:t.get("user").toJSON()})),this.startCursorAnimation(),this}})}),define("lessons/views/typing_falling",["require","templates","registry","lessons/views/typing"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("lessons/views/typing"),n=-20,r=700,o=70,a=880;return i.extend({keyboardType:"large",templateName:"typing_falling",initialize:function(e){return this.lettersTemplate=t("lessons","typing_falling_letters"),this.lessonLength=e.screen.get("content").length,i.prototype.initialize.call(this,e)},render:function(){return i.prototype.render.call(this),this.$("#lesson-content").append(this.template({lesson:this.lesson.toJSON(),user:s.get("user").toJSON()})),setTimeout(this.renderLetters.bind(this),0),this},renderLetters:function(){var e,t={},s=this.$(".keyboard"),i=Math.ceil(this.$(".screen").css("border-left-width").replace("px",""))||0;r-=2*i,a-=2*i,n-=i,o-=i;var l=$("body").hasClass("compact"),c=l?r:a;this.screen.get("content").split("").forEach(function(i){i=i.toLowerCase(),e=i.charCodeAt(0),"⏎"==i&&(e=13),t[e]||(t[e]=Math.min(c-10,s.find(".key-"+e).position().left))}.bind(this)),this.$(".screen").html(this.lettersTemplate({lettersPos:t,typingContent:this.screen.get("content"),rowHeight:52,letterPadding:10,letterWidth:40,rowWidth:l?r:a,viewportHeight:270,viewportLeftOffset:l?n:o})),this.lettersContent=this.$("#lettersContent"),this.progressMeter=this.$("#screenProgress"),this.setPosition(0)},handleErrorTyped:function(e){this.lettersTyped.trackError(e.get("correctLetter")),this.setPosition(e.get("typed"),!0),i.prototype.handleErrorTyped.call(this,e)},setPosition:function(e,t){if(!this.lettersCache){var s=this.$("#lettersContent .letter-line");if(0===s.length)return;this.lettersCache=s,this.keysCache=this.$("#lettersContent .key-letter")}var i=this.lessonLength-e-1,n=this.lettersCache[i],r=this.keysCache[i],o=this.lettersCache[i+1];if(t&&n)return n.classList.add("error"),void $.Velocity(r,"ftw.miniShake",{duration:300});n&&n.classList.add("active"),o&&(o.classList.remove("active"),o.classList.add("complete")),e>0&&(this.animate(e),this.updateProgress(e))},updateProgress:function(e){var t=Math.round(e/this.lessonLength*100);$(this.progressObject).stop().animate({progress:t},{step:function(e){this.progressMeter.css({"background-size":e+"% 100%"})}.bind(this)}),this.progressObject.progress=t},progressObject:{progress:0},animate:function(e){var t=52*(this.lessonLength-e)-270;this.lettersContent.velocity("stop").velocity({top:-1*t})}})}),define("lessons/views/typing_speed",["require","templates","shared/scoring","registry","lessons/views/typing"],function(e){"use strict";var t=e("templates"),s=e("shared/scoring"),i=e("registry"),n=e("lessons/views/typing");return n.extend({keyboardType:"small",templateName:"typing_speed",initialize:function(e){this.statsTemplate=t("lessons","typing_speed_stats"),this.currentLine=0,n.prototype.initialize.call(this,e),this.listenTo(this.screen,"change:line",this.completeLine)},render:function(){return n.prototype.render.call(this),this.$("#lesson-content").append(this.template({minimumLines:4,lesson:this.lesson.toJSON(),typingContent:this.screen.getContentByLine(),user:i.get("user").toJSON()})),this.lines=this.$(".line"),this.lineScores=[],this.startCursorAnimation(),this},completeLine:function(){var e,t,i="";0===this.currentLine?e={typed:this.screen.get("typed"),seconds:this.timer.get("seconds"),errors:this.screen.get("errors"),totalSeconds:this.timer.get("seconds"),totalErrors:this.screen.get("errors")}:(e={typed:(t=this.lineScores[this.currentLine-1]).typed,seconds:this.timer.get("seconds")-t.totalSeconds,errors:this.screen.get("errors")-t.totalErrors,totalSeconds:this.timer.get("seconds"),totalErrors:this.screen.get("errors")},s.speed(e.typed,e.seconds,e.errors)>s.speed(t.typed,t.seconds,t.errors)?i="up":s.speed(e.typed,e.seconds,e.errors)<s.speed(t.typed,t.seconds,t.errors)&&(i="down")),this.lineScores[this.currentLine]=e;var n=s.speed(e.typed,e.seconds,e.errors),r=0;this.currentLine>0&&(r=s.speed(this.lineScores[this.currentLine-1].typed,this.lineScores[this.currentLine-1].seconds,this.lineScores[this.currentLine-1].errors)),$(this.lines[this.currentLine]).addClass("complete "+i).find(".repeat-stats").html(this.statsTemplate({speed:n,improvement:Math.round((n-r)/r*100)})).velocity("fadeIn"),this.currentLine++}})}),define("lessons/views/typing_test",["require","templates","registry","lessons/views/typing"],function(e){"use strict";e("templates");var t=e("registry"),s=e("lessons/views/typing");return s.extend({keyboardType:!1,templateName:"typing_test",initialize:function(e){this.options=e,this.options.problemKeysLesson&&(this.keyboardType="small"),s.prototype.initialize.call(this,e),this.listenTo(this.screen,"change:line",this.animate),this.listenTo(this.timer,"change:startTime",this.beginProgress)},render:function(){return s.prototype.render.call(this),this.$("#lesson-content").append(this.template({lesson:this.lesson.toJSON(),typingContent:this.screen.getContentByLine(),minutes:this.options.minutes,user:t.get("user").toJSON()})),this.typingContent=this.$("#typingContent"),this.progressMeter=this.$("#screenProgress"),this.startCursorAnimation(),this},handleComplete:function(){return this.timer.stop(),this.timer.set({seconds:60*this.options.minutes}),s.prototype.handleComplete.call(this)},beginProgress:function(){var e=60*this.options.minutes,t=function(t){return(e-Math.floor(t/100*e)).countdownSeconds()};$({progress:0}).animate({progress:100},{step:function(e){this.progressMeter.html("<span>"+t(e)+"</span>").css({"background-size":e+"% 100%"})}.bind(this),easing:"linear",duration:60*this.options.minutes*1e3,complete:this.handleComplete.bind(this)})},animate:function(e,t){this.typingContent.velocity("stop").velocity({top:50*t*-1},"slow","linear")}})}),define("shared/keyboard_input",["require","registry"],function(e){"use strict";var t=e("registry"),s=function(){};return _.extend(s.prototype,Backbone.Events,{boundElement:null,capsLockWarningOn:!1,initialize:function(){t.get("isMobile")&&"software"==t.get("user").get("_mobileKeyboard")&&(this.boundElement=$("#mobile-input").fastShow(),this.boundElement.on("focus",this.hideMobileFocus.bind(this)),this.boundElement.on("blur",this.showMobileFocus.bind(this)),this.trigger("input-blur")),$(document).on("keypress",this.boundElement,_.bind(this.handleKeyPress,this)),$(document).on("keydown",this.boundElement,_.bind(this.handleKeyDown,this)),$(document).on("blur",this.boundElement,_.bind(this.handleBlur,this)),$(document).on("focus",this.boundElement,_.bind(this.handleFocus,this))},showMobileFocus:function(){$("#ios-overlay").velocity("fadeIn")},hideMobileFocus:function(){$("#ios-overlay").fastHide()},stop:function(){$(document).off("keypress keydown blur focus")},prevKeyPress:null,handleKeyPress:function(e){if(this.prevKeyPress&&this.prevKeyPress.timeStamp===e.timeStamp)return!1;this.prevKeyPress=e;var t=null;if(e.target.form&&("contactForm"==e.target.form.id||"nameForm"==e.target.form.id))return!0;switch(e.which=e.which||e.keyCode,e.which){case 13:t="\n"}return t||(t=String.fromCharCode(e.which)),!e.shiftKey&&t.match(/[a-zA-Z]/)&&(t!==t.toUpperCase()||this.capsLockWarningOn?t!==t.toUpperCase()&&this.capsLockWarningOn&&(this.trigger("capslock",!1),this.capsLockWarningOn=!1):(this.trigger("capslock",!0),this.capsLockWarningOn=!0)),this.trigger("keypress",{keyCode:e.which,key:t,special:!1}),!1},prevKeyDown:null,handleKeyDown:function(e){if(this.prevKeyDown&&this.prevKeyDown.timeStamp===e.timeStamp)return!1;if(this.prevKeyDown=e,e.target.form&&("contactForm"==e.target.form.id||"nameForm"==e.target.form.id))return!0;var t=null;switch(e.which=e.which||e.keyCode,e.which){case 9:t="TAB";break;case 20:t="CAPSLOCK";break;case 91:t="CMD";break;case 18:t="ALT";break;case 16:t="SHIFT";break;case 17:t="CTRL";break;case 8:t="BACKSPACE";break;case 46:t="DELETE";break;case 12:t="NUMLOCK";break;case 27:t="ESC";break;case 32:return this.handleKeyPress(e)}return"CAPSLOCK"!==t||this.capsLockWarningOn||(this.trigger("capslock",!0),this.capsLockWarningOn=!0),192==e.which&&e.shiftKey&&e.ctrlKey&&(t="NEXT"),null!==t?(this.trigger("keypress",{keyCode:e.which,key:t,special:!0}),!1):void 0},handleFocus:function(e){this.trigger("focus",e)},handleBlur:function(e){this.trigger("blur",e)}}),s}),define("global/models/timer",["require"],function(e){"use strict";return Backbone.Model.extend({default:{startTime:0,seconds:0},initialize:function(){},start:function(e,t){return this.get("startTime")?this:(this.set({startTime:this.getTime(t),pauseTime:0}),this.interval=setInterval(this._updateSeconds.bind(this),100),this)},pause:function(){return this.set({pauseTime:this.getTime()}),this},unpause:function(){return this.inc({startTime:this.getTime()-this.get("pauseTime")}),this.set({pauseTime:0}),this},stop:function(){return clearInterval(this.interval),this},getTime:function(e){return(e=e||new Date).getTime()/1e3},_updateSeconds:function(){var e=this.get("pauseTime")||this.getTime();this.set({seconds:e-this.get("startTime")})}})}),define("global/collections/keyboards",["require"],function(e){"use strict";var t=Backbone.Model.extend({idAttribute:"keyboard_id"});return Backbone.Collection.extend({model:t,comparator:"sort_order"})}),define("global/collections/letters_typed",["require"],function(e){"use strict";var t=Backbone.Model.extend({defaults:{id:"",typed:0,errors:0}});return Backbone.Collection.extend({model:t,trackCorrect:function(e){if(this.valid(e)){e=e.toLowerCase();var t=this.get(e);t?t.inc({typed:1}):this.add({id:e,typed:1})}},trackError:function(e){if(this.valid(e)){e=e.toLowerCase();var t=this.get(e);t?t.inc({errors:1}):this.add({id:e,errors:1})}this.trackCorrect(e)},valid:function(e){if(e)return!(e.length>1)&&(""!==$.trim(e)&&!!e.match(/[A-Za-z]/))},topProblemKeys:function(e){e=e||4;var t=this.map(function(e){return{id:e.id,percent:e.attributes.errors/e.attributes.typed}});return _.chain(t).sortBy(function(e){return-1*e.percent}).filter(function(e){return e.percent>0}).sortBy(function(e){return-e.percent}).first(e).value()},merge:function(e){var t;e.forEach(function(e){(t=this.get(e.id))?t.inc({typed:e.typed,errors:e.errors}):this.add(e)}.bind(this))},clear:function(){this.reset(),$.postJSON("/apiv1/student/user/reset-problem-keys")}})}),define("lessons/views/mobile_keyboard_modal",["require","templates"],function(e){"use strict";var t=e("templates");return Backbone.View.extend({events:{"click .keyboard-button":"clickButton"},initialize:function(e){this.template=t("lessons","mobile_keyboard_modal")},render:function(){return this.$el.html(this.template({})),this},clickButton:function(e){$(e.currentTarget).hasClass("software")?this.trigger("complete","software"):this.trigger("complete","hardware")}})}),define("lessons/index",["require","templates","registry","global/views/modal","shared/scoring","shared/radar_tracker","global/models/lesson","lessons/collections/screens","lessons/collections/problemkey_screens","lessons/views/nav","lessons/views/intro","lessons/views/congrats","lessons/views/screen_complete","lessons/views/screen_failed","lessons/views/test_complete","lessons/views/progress","lessons/views/typing_standard","lessons/views/typing_falling","lessons/views/typing_speed","lessons/views/typing_test","shared/keyboard_input","global/models/timer","shared/tooltip","global/collections/keyboards","global/collections/user_lesson_screens","global/collections/letters_typed","lessons/views/mobile_keyboard_modal","shared/model_backends/localstorage"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("global/views/modal"),n=e("shared/scoring"),r=e("shared/radar_tracker"),o=e("global/models/lesson"),a=e("lessons/collections/screens"),l=e("lessons/collections/problemkey_screens"),c=e("lessons/views/nav"),d=e("lessons/views/intro"),h=e("lessons/views/congrats"),u=e("lessons/views/screen_complete"),p=e("lessons/views/screen_failed"),g=e("lessons/views/test_complete"),m=e("lessons/views/progress"),f=e("lessons/views/typing_standard"),y=e("lessons/views/typing_falling"),b=e("lessons/views/typing_speed"),v=e("lessons/views/typing_test"),w=e("shared/keyboard_input"),k=e("global/models/timer"),L=e("shared/tooltip"),S=e("global/collections/keyboards"),T=e("global/collections/user_lesson_screens"),C=e("global/collections/letters_typed"),x=e("lessons/views/mobile_keyboard_modal"),O=e("shared/model_backends/localstorage");return Backbone.View.extend({el:"#js-content",events:{},initialize:function(e){this.options=e,void 0===this.template&&(this.template=t("lessons","index")),this.screenTypes={standard:f,speed:b,falling:y,test:v},this.user=s.get("user"),this.userBadges=s.get("userBadges"),this.userLettersTyped=s.get("userLettersTyped"),this.userActivity=s.get("userActivity"),this.userTests=s.get("userTests"),this.input=new w,this.timer=new k,this.lesson=new o(FTWGLOBALS("lesson"));var i=new S(FTWKEYBOARDS),n=380==this.lesson.id||351==this.lesson.id?29:this.user.get("keyboard_id");if(this.keyboard=i.get(n),this.options.problemkeys){if(!FTWGLOBALS("loggedIn"))return $.loginRedirect("student"),!1;this.options.test=!0,this.options.minutes=1,this.screens=new l(FTWGLOBALS("screens"),{words:FTWGLOBALS("words"),letters:this.userLettersTyped.topProblemKeys(3)})}else if(this.options.test){this.lesson.set({screens:1});var L=FTWGLOBALS("screens")[0];L.title=this.options.minutes+":00 Typing Test",L.content=_.shuffle(FTWGLOBALS("screens")).map(function(e){return e.content.replace(/\n+/g,"\n").trim()}).join("\n").substr(0,750*this.options.minutes),this.screens=new a([L])}else this.screens=new a(FTWGLOBALS("screens"));this.lettersTyped=new C;var x=s.get("userLessons");if(this.userLesson=x.get(this.lesson.id),this.userLesson||(this.userLesson=x.add({lesson_id:this.lesson.id})),this.options.test&&this.userLesson.get("progress")>0&&this.userLesson.set({progress:0}),this.userLessonScreens=new T(null,{lesson_id:this.lesson.id}),this.userLessonScreens.setBackend(new O("userLessonScreens"+this.lesson.id),"backend"),this.userLessonScreens.length>0&&this.userLessonScreens.at(0).get("user_id")!=this.user.id&&this.userLessonScreens.reset(),this.options.test||this.options.problemkeys||document.referrer.match(/\/student\/lessons/)||r.track(s.get("user"),{seconds:this.userLesson.get("seconds"),errors:this.userLesson.get("errors"),typed:this.userLesson.get("typed"),progress:this.userLesson.get("progress")}),this.screen=this.screens.at(this.userLesson.get("progress")),this.screen){this.screen.formatContent(this.keyboard,this.user),this.screen.get("intro")&&(this.intro=new d({test:this.options.test&&!this.options.problemkeys,keyboard:this.keyboard,contents:this.screen.get("intro"),input:this.input}),this.intro.once("begin",this.showScreen.bind(this)));var A=this.options.test?"test":this.screen.get("screen_type");this.typing=new this.screenTypes[A]({keyboard:this.keyboard,lesson:this.lesson,screens:this.screens,screen:this.screen,input:this.input,timer:this.timer,userLesson:this.userLesson,userLessonScreens:this.userLessonScreens,lettersTyped:this.lettersTyped,problemKeysLesson:this.options.problemkeys,minutes:this.options.minutes}),this.typing.once("complete",this.handleScreenComplete.bind(this)),this.options.test?this.screenComplete=new g({lesson:this.lesson,screens:this.screens,screen:this.screen,input:this.input,timer:this.timer,typingView:this.typing,userLesson:this.userLesson,userLessonScreens:this.userLessonScreens,lettersTyped:this.lettersTyped,problemKeysLesson:this.options.problemkeys,screenType:A}):this.screenComplete=new u({lesson:this.lesson,screens:this.screens,screen:this.screen,input:this.input,timer:this.timer,typingView:this.typing,userLesson:this.userLesson,userLessonScreens:this.userLessonScreens,lettersTyped:this.lettersTyped,screenType:A}),this.screenFailed=new p({lesson:this.lesson,screens:this.screens,screen:this.screen,input:this.input,timer:this.timer,typingView:this.typing,userLesson:this.userLesson,userLessonScreens:this.userLessonScreens,lettersTyped:this.lettersTyped,screenType:A})}else this.congrats=new h({lesson:this.lesson,lettersTyped:this.lettersTyped,userLesson:this.userLesson,userLessonScreens:this.userLessonScreens});this.navigation=new c({lesson:this.lesson,screen:this.screen,timer:this.timer,userLesson:this.userLesson}),this.options.test||(this.progress=new m({lesson:this.lesson,screens:this.screens,screen:this.screen,userLesson:this.userLesson,userLessonScreens:this.userLessonScreens})),this.userLesson.get("progress")>0&&0===this.userLessonScreens.length?(this.userLessonScreens.once("reset",this.render.bind(this)),this.userLessonScreens.fetch({reset:!0})):this.render()},render:function(){var e=$(this.template({loading:!1}));e.find("#typing-nav").append(this.navigation.render().el),this.userLesson.get("progress")==this.lesson.get("screens")?e.find("#typing-contents").append(this.congrats.render().el):this.intro?e.find("#typing-contents").append(this.intro.render().el):e.find("#typing-contents").append(this.typing.render().el),this.progress&&e.find("#typing-progress").append(this.progress.render().el),0===this.userLesson.get("progress")&&this.user.unset("_mobileKeyboard"),this.$el.html(e),s.get("isMobile")&&!this.user.get("_mobileKeyboard")?this.showKeyboardSelectModal():this.input.initialize(),L.init()},showKeyboardSelectModal:function(){var e=new i({title:"Select Tablet/Mobile Keyboard Type",okButton:"",cancelButton:"",closeButton:!1,contentView:new x});e.show(),e.on("complete",function(e){this.user.set({_mobileKeyboard:e}),this.input.initialize()}.bind(this))},showScreen:function(){this.intro.hide(),this.userLesson.get("progress")==this.lesson.get("screens")?this.$("#typing-contents").append(this.congrats.render().el):this.$("#typing-contents").append(this.typing.render().el),L.init()},handleScreenComplete:function(){if(this.typing.hide(),n.accuracy(this.screen.get("typed"),this.screen.get("errors"))<this.lesson.get("min_accuracy"))this.$("#typing-contents").append(this.screenFailed.render().el);else{this.$("#typing-contents").append(this.screenComplete.render().el),this.screenStats={lesson_id:this.lesson.id,lesson_screen_id:parseInt(this.screen.id),seconds:this.screen.get("seconds"),errors:this.screen.get("errors"),typed:this.screen.get("typed"),std:this.screen.get("std"),stars:n.stars(n.accuracy(this.screen.get("typed"),this.screen.get("errors")),this.user.get("two_stars"),this.user.get("three_stars")),completed:this.userLesson.get("progress")+1==this.lesson.get("screens")?1:0,progress:this.userLesson.get("progress")+1,created_at:Date.getUnixTime(),test:this.options.test?1:0,now:Math.floor(Date.now()/1e3)};var e=this.userLessonScreens.get(parseInt(this.screen.id));e&&(this.screenStats.prev_seconds=e.get("seconds"),this.screenStats.prev_errors=e.get("errors"),this.screenStats.prev_typed=e.get("typed"),this.screenStats.prev_stars=e.get("stars"),this.screenStats.prev_completed=e.get("completed")),this.saveStats()}},saveStats:function(){this.screenComplete.once("try-again",this.saveStats,this),this.userLesson.saveStats(this.screenStats,this.lettersTyped.toJSON()).done(function(){this.screenComplete.showSaved(),this.updateLocalStats()}.bind(this)).fail(function(){this.screenComplete.showSaveError()}.bind(this))},updateLocalStats:function(){var e=this.screenStats;if(!this.options.problemkeys)if(this.options.test)this.userTests.reset();else{var t={progress:1,typed:e.typed,errors:e.errors,seconds:e.seconds,stars:e.stars,completed:e.completed},s=this.userLessonScreens.get(e.lesson_screen_id);if(s&&(t.typed-=s.get("typed"),t.seconds-=s.get("seconds"),t.errors-=s.get("errors"),t.stars-=s.get("stars"),t.completed-=s.get("completed")),this.userLesson.inc(t),this.userLesson.set({max_progress:Math.max(this.userLesson.get("progress"),this.userLesson.get("max_progress")),updated_at:e.created_at}),this.userLessonScreens.add(e,{merge:!0}),FTWGLOBALS("loggedIn")&&this.screenStats.completed&&!this.userBadges.get(this.lesson.id)){var i=this.userLesson.toJSON();i.created_at=Math.round(Date.now()/1e3),this.userBadges.add(i)}}this.userActivity.merge(this.screenStats),this.userLettersTyped.merge(this.lettersTyped.toJSON())}})}),define("global/views/chart",["require","templates"],function(e){"use strict";var t=e("templates");return Backbone.View.extend({options:{scaleGridLineColor:"rgba(234,234,234,1)",scaleShowLabels:!1,pointDotRadius:8,pointDotStrokeWidth:3,pointHitDetectionRadius:0,datasetStrokeWidth:1,bezierCurve:!1,showTooltips:!0,tooltipFillColor:"#000000",tooltipFontColor:"#ffffff",showLabels:!1},dataset:{labels:[],data:[]},initialize:function(e){void 0===this.template&&(this.template=t("global","chart")),e.width=e.width||this.width||548,e.height=e.height||this.height||100,e.type=(e.type||this.type||"line").ucFirst(),this.setOptions(e)},setData:function(e,t){(t=t||{}).data=e,this.dataset=t},setOptions:function(e){_.extend(this.options,e)},render:function(){if(this.$el.html(this.template({options:this.options,data:this.dataset.data})),this.dataset.data.length>0){var e=this.$("canvas")[0],t=e.getContext("2d"),s=_.pluck(this.dataset.data,"label");window.devicePixelRatio>1&&(e.width=this.options.width,e.height=this.options.height,e.style.width=this.options.width/window.devicePixelRatio+"px",e.style.height=this.options.height/window.devicePixelRatio+"px",t.scale(window.devicePixelRatio,window.devicePixelRatio)),new Chart(t)[this.options.type]({labels:s,datasets:[this.dataset]},this.options)}}})}),define("test/views/graph",["require","global/views/chart","templates","shared/scoring"],function(e){"use strict";var t=e("global/views/chart"),s=e("templates"),i=e("shared/scoring");return t.extend({sampleData:[],initialize:function(e){e=e||{},this.waitingTemplate=s("test","graph_waiting"),e.tooltipTemplate=function(e){var t=this.dataset.data[e.index];return moment(1e3*t.created_at).format("lll")+" "+Math.round(t.seconds/60)+" minute "+t.value+" WPM "+i.accuracy(t)+"% acc"}.bind(this),this.renderWaiting(),this.listenTo(this.collection,"reset",this.setData),t.prototype.initialize.call(this,e)},renderWaiting:function(){this.$el.html(this.waitingTemplate())},setData:function(){if(this.collection.length<2){this.$el.addClass("sample");var e=[{user_test_id:6,seconds:60,errors:0,typed:266,created_at:1426181915},{user_test_id:5,seconds:60,errors:10,typed:285,created_at:1421794858},{user_test_id:4,seconds:60,errors:12,typed:330,created_at:1421793538},{user_test_id:3,seconds:60,errors:12,typed:360,created_at:1421791395},{user_test_id:2,seconds:60,errors:0,typed:380,created_at:1421791394}];e.reverse(),this.collection=new Backbone.Collection(e)}var s=this.collection.toJSON().reverse(),n={fillColor:"transparent",strokeColor:"#3295db",pointStrokeColor:"#ffffff",pointColor:"#3295db"};s=_.map(s,function(e){return e.date=e.label,e.label="",e.pointLabel=Math.round(e.seconds/60),e.value=i.speed(e),e},this),t.prototype.setData.call(this,s,n),this.render()}})}),define("test/views/table",["require","templates","shared/scoring","global/views/notice","global/views/modal","test/views/name_modal","registry"],function(e){"use strict";var t=e("templates"),s=e("shared/scoring"),i=e("global/views/notice"),n=e("global/views/modal"),r=e("test/views/name_modal"),o=e("registry");return Backbone.View.extend({events:{"click .print":"clickPrint"},initialize:function(){this.template=t("test","table"),this.user=o.get("user"),this.collection.length||!FTWGLOBALS("loggedIn")?this.render():(this.renderLoading(),this.collection.on("reset",this.render.bind(this)))},renderLoading:function(){return this.$el.html(this.template({loading:!0})),this},render:function(){var e=this.collection.toJSON().map(function(e){return e.minutes=Math.round(e.seconds/60)+" minute"+Math.round(e.seconds/60).pluralize(),e.speed=s.speed(e.typed,e.seconds,e.errors),e.accuracy=s.accuracy(e.typed,e.errors),e});return this.$el.html(this.template({loading:!1,loggedIn:FTWGLOBALS("loggedIn"),data:e})),this},clickPrint:function(e){var t=$(e.currentTarget).data("id");return this.user.get("first_name")||this.user.get("last_name")?window.open("/apiv1/student/tests/"+t+"/certificate"):this.requestName(),!1},requestName:function(){var e=new n({title:"Enter Your Name",okButton:"Continue",cancelButton:"Cancel",contentView:new r,width:500});return e.on("complete",function(){new i({error:!1,text:"Your name has been updated. You may now print your certificate."}).show()}.bind(this)),e.show(),!1}})}),define("test/index",["require","templates","registry","shared/scoring","test/views/graph","test/views/table"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=(e("shared/scoring"),e("test/views/graph")),n=e("test/views/table");return Backbone.View.extend({el:"#js-content",initialize:function(){this.template=t("test","index"),this.tests=s.get("userTests"),FTWGLOBALS("loggedIn")||this.tests.reset(),this.table=new n({collection:this.tests});var e=$("body").hasClass("compact")?394:574;this.graph=new i({width:e,height:144,collection:this.tests}),this.render(),FTWGLOBALS("loggedIn")&&0===this.tests.length?this.tests.fetch({reset:!0}):this.tests.trigger("reset")},render:function(){this.$el.append(this.template()),this.$("#testGraph").html(this.graph.el),this.$("#tableContents").append(this.table.el)}})}),define("games/views/scoreboard",["require","templates","registry"],function(e){"use strict";var t=e("templates"),s=e("registry");return Backbone.View.extend({events:{},initialize:function(e){this.options=e,void 0===this.template&&(this.template=t("games","scoreboard")),this.user=s.get("user")},render:function(){return this.$el.html(this.template({loggedIn:loggedIn(),recent:this.options.recentScores.toJSON(),high:this.options.highScores.toJSON()})),this},hide:function(){this.$("input[type=checkbox]").prop("checked")&&$.post("/apiv1/student/user/account",{migrated:2}),this.user.set({migrated:0}),this.$el.velocity("slideUp")}})}),define("games/models/score",["require"],function(e){"use strict";return Backbone.Model.extend({initialize:function(){},urlRoot:"/apiv1/student/games",defaults:{game_id:0,score:0,seconds:0,created_at:0},saveScore:function(){var e=rot47(JSON.stringify(this.toJSON()));return $.post(this.urlRoot,{data:e})}})}),define("games/collections/scores",["require","games/models/score"],function(e){"use strict";var t=e("games/models/score");return Backbone.Collection.extend({model:t,url:"/apiv1/student/games",getScores:function(e){return $.get(this.url+"?id="+e)}})}),define("global/views/video_ad",["require"],function(e){"use strict";return Backbone.View.extend({adDisplayContainer:null,adsLoader:null,adsRequest:null,adBlocker:!1,initialize:function(e){this.options=e,this.game=e.game,void 0!==window.google?(this.adDisplayContainer=new google.ima.AdDisplayContainer(this.el,this.game[0]),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.managerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.error.bind(this),!1),this.adsRequest=new google.ima.AdsRequest,this.adsRequest.adTagUrl=e.adUrl,this.adsRequest.linearAdSlotWidth=640,this.adsRequest.linearAdSlotHeight=400,this.adsRequest.nonLinearAdSlotWidth=640,this.adsRequest.nonLinearAdSlotHeight=150,this.adsLoader.requestAds(this.adsRequest)):this.adBlocker=!0},error:function(e){console.error("Video Ad Loading Error"),console.error(e.getError()),this.adsManager&&this.adsManager.destroy(),this.trigger("complete")},managerLoaded:function(e){var t=new google.ima.AdsRenderingSettings;t.restoreCustomPlaybackStateOnAdBreakComplete=!0,this.adsManager=e.getAdsManager(this.game[0],t),this.adDisplayContainer.initialize(),this.adsManager.init(this.options.width,this.options.height,google.ima.ViewMode.NORMAL),this.adsManager.start(),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.error.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,this.adEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,this.adEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.USER_CLOSE,this.adEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,this.adEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,this.adEvent.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,this.adEvent.bind(this))},adEvent:function(e){switch(e.type){case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:case google.ima.AdEvent.Type.COMPLETE:case google.ima.AdEvent.Type.SKIPPED:case google.ima.AdEvent.Type.USER_CLOSE:this.trigger("complete")}}})}),define("games/play",["require","templates","registry","games/views/scoreboard","games/models/score","games/collections/scores","global/views/video_ad"],function(e){"use strict";e("templates");var t=e("registry"),s=e("games/views/scoreboard"),i=e("games/models/score"),n=e("games/collections/scores"),r=e("global/views/video_ad");return Backbone.View.extend({el:"#js-content",initialize:function(e){this.options=e||{},this.user=t.get("user"),this.highScores=new n,this.recentScores=new n,this.highScores.comparator=function(e){return-e.get("score")},this.scoreboardView=new s({el:this.$(".js-scoreboard"),highScores:this.highScores,recentScores:this.recentScores}),window.submitGameScoreboard=this.gameOver.bind(this),loggedIn()&&FTWGLOBALS("game").scoreboard?this.highScores.getScores(FTWGLOBALS("game").game_id).done(this.update.bind(this)):this.scoreboardView.render(),paid()?this.startGame():this.showAd()},showAd:function(){this.ad=new r({el:this.$("#ad-content"),game:this.$("#game-content"),adUrl:FTWGLOBALS("adUrl"),width:916,height:400}),this.ad.adBlocker?this.startGame():this.listenTo(this.ad,"complete",this.startGame)},startGame:function(){var e=FTWGLOBALS("game");"javascript"==e.type&&(Game.inited||(new Game(e.width,e.height,"/game_files/"+e.folder,this.$("#game")[0]),Game.inited=!0)),this.$("#ad-content").fastHide(),this.$("#game-content").fastShow()},update:function(e){this.highScores.reset(e.data.high,{reset:!0}),this.recentScores.reset(e.data.recent,{reset:!0}),this.scoreboardView.render()},gameOver:function(e){if(loggedIn()&&!(e.seconds<=0)){e.game_id=FTWGLOBALS("game").game_id,e.created_at=Date.getUnixTime();var t=new i(e);t.saveScore(),"hard"==e.difficulty&&"hard"==e.level&&(this.recentScores.unshift(t),this.highScores.add(t),this.highScores.length>3&&this.highScores.pop(),this.scoreboardView.render())}}})}),define("skins/index",["require","templates","registry"],function(e){"use strict";e("templates");var t=e("registry");return Backbone.View.extend({el:"#js-content",events:{"click .skin":"changeSkin"},initialize:function(){this.user=t.get("user")},changeSkin:function(e){var t=$(e.currentTarget).data("id"),s=$.cookie("tc_skin")||"0";return this.user.changeSkin(t),$("body").removeClass("skin"+s).addClass("skin"+t),!1}})}),define("badges/index",["require","templates","registry","shared/scoring","global/collections/badges","global/collections/courses","global/collections/lessons"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/scoring"),n=e("global/collections/badges"),r=e("global/collections/courses"),o=e("global/collections/lessons");return Backbone.View.extend({el:"#js-content",events:{"mouseenter .badge":"hoverBadge","mouseleave .badge":"hoverBadge"},initialize:function(){this.template=t("badges","index"),this.badges=new n,this.courses=new r(FTWGLOBALS("courses")),this.lessons=new o(FTWGLOBALS("lessons")),this.userBadges=s.get("userBadges"),this.render()},render:function(){return this.$el.html(this.template({courses:this.courses.toJSON(),lessons:this.lessons.toJSON(),userBadges:this.userBadges,badges:this.badges,scoring:i})),this},hoverBadge:function(e){"mouseenter"==e.type?$(e.currentTarget).velocity("stop",!0).velocity({scale:[1.2,1]},100):$(e.currentTarget).velocity("stop",!0).velocity("reverse",50)}})}),define("settings/views/info",["require","templates","registry"],function(e){"use strict";var t=e("templates"),s=e("registry");return Backbone.View.extend({initialize:function(){this.template=t("settings","info"),this.render()},render:function(){return this.$el.html(this.template({user:s.get("user").toJSON()})),this}})}),define("settings/views/account",["require","templates","registry","shared/form_model","shared/form_validation"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/form_model"),n=e("shared/form_validation"),r=i.extend({url:"/apiv1/student/user/account",defaults:{email:"",first_name:"",last_name:"",country:"",allow_contact:0,spaces:1,speed:"wpm",sounds:1},validationRules:{email:{email:!0}},validationMessages:{email:{email:"Invalid email address",INVALID_EMAIL:"Invalid email address",EMAIL_IN_USE:"This email is in use by a different account"}}});return Backbone.View.extend({events:{"keypress input":"submitOnEnter"},initialize:function(){this.template=t("settings","account"),this.render(),this.model=new r,this.form=this.$("form");var e=this.$("form .submit");new n(this.form,e,this.model,this.successCallback,this,!0)},render:function(){return this.$el.html(this.template({user:s.get("user").toJSON(),countries:FTWGLOBALS("countries")})),this},successCallback:function(e){s.get("user").set(e),this.form.velocity("slideUp",function(){this.$(".confirm").slideDown()}.bind(this))},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}})}),define("settings/views/password",["require","templates","registry","shared/form_model","shared/form_validation"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/form_model"),n=e("shared/form_validation"),r=i.extend({initialize:function(){$.validator.addMethod("notMatchUsername",function(e){return e!=s.get("user").get("username")},"Can not match username")},url:"/apiv1/student/user/password",defaults:{oldPassword:"",password:"",password2:""},validationRules:{oldPassword:{required:!0},password:{notMatchUsername:!0,required:!0,minlength:4},password2:{required:!0,minlength:4,equalTo:"input[name=password]"}},validationMessages:{password2:{equalTo:"Passwords do not match"},oldPassword:{INCORRECT_PASSWORD:"Incorrect password"}}});return Backbone.View.extend({events:{"keypress input":"submitOnEnter"},initialize:function(){this.template=t("settings","password"),this.render(),this.model=new r,this.form=this.$("form");var e=this.$("form .submit");new n(this.form,e,this.model,this.successCallback,this,!0)},render:function(){return this.$el.html(this.template()),this},successCallback:function(e){this.form.velocity("slideUp",function(){this.$(".confirm").slideDown()}.bind(this))},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}})}),define("settings/views/keyboard",["require","templates","registry","shared/form_model","shared/form_validation","global/views/keyboard","global/collections/keyboards"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/form_model"),n=e("shared/form_validation"),r=e("global/views/keyboard"),o=e("global/collections/keyboards"),a=i.extend({events:{"keypress input":"submitOnEnter"},url:"/apiv1/student/user/account",defaults:{keyboard_id:1},validationRules:{keyboard_id:{required:!0}}});return Backbone.View.extend({events:{"change select[name=keyboard_id]":"changeKeyboard","keypress input":"submitOnEnter"},initialize:function(){this.template=t("settings","keyboard"),this.keyboards=new o(FTWKEYBOARDS),this.keyboard=new r({type:"large",noHands:!0,noControls:!0,model:this.keyboards.get(s.get("user").get("keyboard_id"))}),this.render(),this.model=new a,this.form=this.$("form");var e=this.$("form .submit");new n(this.form,e,this.model,this.successCallback,this,!0)},render:function(){return this.$el.html(this.template({user:s.get("user").toJSON(),keyboards:this.keyboards.toJSON()})),this.$("#keyboardContainer").append(this.keyboard.render().el),this},changeKeyboard:function(e){var t=$(e.target).val();this.keyboard.setKeyboard({type:"large",noHands:!0,noControls:!0,model:this.keyboards.get(parseInt(t,10))}).render()},successCallback:function(e){s.get("user").set(e),this.form.velocity("slideUp",function(){this.$(".confirm").slideDown()}.bind(this))},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}})}),define("settings/views/join",["require","templates","registry","shared/form_model","shared/form_validation"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/form_model"),n=e("shared/form_validation"),r=i.extend({url:"/apiv1/student/user/join",defaults:{join_code:"",section_id:""},validationRules:{join_code:{required:!0}},validationMessages:{join_code:{INVALID:"Invalid Code. Please make sure you typed it correctly."}}});return Backbone.View.extend({events:{"keypress input":"submitOnEnter"},initialize:function(){this.template=t("settings","join"),this.model=new r,this.render()},render:function(){this.$el.html(this.template({user:s.get("user").toJSON(),joinCode:this.model.get("join_code"),sections:this.sections?this.sections.toJSON():[]})),this.form=this.$("form");var e=this.$("form .submit");return new n(this.form,e,this.model,this.successCallback,this,!0),this},successCallback:function(e){if(e.teacher_id)s.get("user").set(e),this.form.velocity("slideUp",function(){this.$(".confirm").slideDown()}.bind(this));else{var t=this.model.toJSON();this.model.clear(),this.model.set({join_code:t.join_code,section_id:t.section_id}),this.sections=new Backbone.Collection(e),this.form.velocity("fadeOut",function(){this.render()}.bind(this),{visibility:"hidden"})}},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}})}),define("settings/index",["require","templates","registry","settings/views/info","settings/views/account","settings/views/password","settings/views/keyboard","settings/views/join"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("settings/views/info"),n=e("settings/views/account"),r=e("settings/views/password"),o=e("settings/views/keyboard"),a=e("settings/views/join");return Backbone.View.extend({el:"#js-content",initialize:function(){this.template=t("settings","index"),this.user=s.get("user"),loggedIn()?this.render():location.href="/student"},render:function(){this.$el.html(this.template());var e=this.$(".page-settings");return e.append((new i).el),this.user.get("no_account_change")||"clever"==this.user.get("login_type")||e.append((new n).el),this.user.get("no_password_change")||"username"!=this.user.get("login_type")||e.append((new r).el),this.user.get("no_account_change")||e.append((new o).el),"clever"!=s.get("user").get("login_type")&&e.append((new a).el),this}})}),define("upgrade/models/upgrade",["require"],function(e){"use strict";return Backbone.Model.extend({url:"/apiv1/student/upgrade"})}),define("upgrade/index",["require","templates","registry","shared/analytics","upgrade/models/upgrade","global/views/notice"],function(e){"use strict";var t=e("templates"),s=e("registry"),i=e("shared/analytics"),n=e("upgrade/models/upgrade"),r=e("global/views/notice");return Backbone.View.extend({events:{"click .purchase-box .button":"upgrade"},el:"#js-content",initialize:function(){this.template=t("upgrade","index"),this.templateComplete=t("upgrade","complete"),this.templateWaiting=t("upgrade","waiting"),this.user=s.get("user"),this.model=new n,"object"==typeof StripeCheckout?(this.stripeHandler=StripeCheckout.configure({key:FTWGLOBALS("stripeKey"),image:"/dist/shared/images/stripe.jpg",token:this.confirmOrder.bind(this),bitcoin:!0}),$(window).on("popstate",this.stripeHandler.close.bind(this.stripeHandler)),this.render()):alert('Uh oh! It looks like your network is blocking our payment gateway. To upgrade, please allow "stripe.com" in your firewall, or upgrade using a different internet connection.')},render:function(){this.$el.velocity("stop").html(this.template({user:this.user.toJSON(),price:FTWGLOBALS("product").price}))},renderWaiting:function(){this.$el.velocity("slideUp",function(){this.$el.html(this.templateWaiting({})).slideDown()}.bind(this))},renderComplete:function(e){this.$el.html(this.templateComplete({data:e}))},upgrade:function(){if(!FTWGLOBALS("loggedIn"))return new r({error:!0,text:"You must log in to upgrade an account!"}).show(),!1;{if(!paid())return this.stripeHandler.open({name:"Typing.com",description:" Account Upgrade for "+this.user.get("username"),amount:Math.round(100*FTWGLOBALS("product").price),zipCode:!0,email:this.user.get("email")||null,allowRememberMe:!0}),!1;new r({error:!0,text:"Your account is already upgraded!  If you are still seeing ads, try logging out and back in."}).show()}},confirmOrder:function(e){this.renderWaiting(),this.model.save(e).done(function(e){var t=e.data;t.total=t.price,t.store="Typing.com";var s=[{product:"Premium Upgrade",price:t.total,quantity:1,category:"Student"}];this.user.refreshCookie(2,!0),this.renderComplete(t),i.trackSale(t,s)}.bind(this)).fail(function(e){this.render(),e.responseJSON?e.responseJSON.data.declined?new r({error:!0,text:"Your credit card was declined: "+e.responseJSON.data.declined+".  Please try again!"}).show():new r({error:!0,text:"Uh oh! An error occurred: "+e.responseJSON.data.error+" Please try again!"}).show():new r({error:!0,text:"An unknown error occurred!  Please try again"}).show()}.bind(this))}})}),define("router",["require","index/index","oauth/index","index/index","index/login","join/index","index/login","password/index","scoreboard/index","verify/index","lessons/index","lessons/index","lessons/index","test/index","games/play","skins/index","badges/index","settings/index","upgrade/index"],function(e){"use strict";var t=Backbone.Router.extend({initialize:function(){},routes:{"":function(){new(e("index/index"))},oauth:function(){new(e("oauth/index"))},start:function(){new(e("index/index"))({start:!0})},login:function(){new(e("index/login"))},join:function(){new(e("join/index"))({code:location.hash.replace("#","")})},signup:function(){new(e("index/login"))},password:function(){new(e("password/index"))},scoreboard:function(){new(e("scoreboard/index"))},verify:function(){var t;t=location.hash.match(/\|/)?location.hash.replace("#","").split("|"):location.hash.replace("#","").split("-"),new(e("verify/index"))({user_test_id:parseInt(t[0]),user_id:parseInt(t[1])})},"lessons/problemkeys":function(){new(e("lessons/index"))({problemkeys:!0})},"lessons/:id(/:slug)(/:index)":function(t){new(e("lessons/index"))({lessonId:t})},"test/:minutes":function(t){new(e("lessons/index"))({test:!0,minutes:t})},test:function(t){new(e("test/index"))},"games/play/:slug":function(t){new(e("games/play"))},skins:function(){new(e("skins/index"))},badges:function(){new(e("badges/index"))},settings:function(){new(e("settings/index"))},upgrade:function(){new(e("upgrade/index"))}}});return{initialize:function(){new t,Backbone.history.start({pushState:!0,root:"/student/"})}}}),define("global/models/user",["require","shared/model_backends/localstorage","registry"],function(e){"use strict";var t=e("shared/model_backends/localstorage"),s=e("registry");return Backbone.Model.extend({idAttribute:"user_id",defaults:{user_id:0,user_session_id:0,teacher_id:null,section_id:null,username:"",first_name:"",last_name:"",country:"",email:"",allow_contact:1,membership:"free",last_login:0,speed:"wpm",spaces:1,keyboard_id:1,skin_id:0,language:"en",scoreboard:1,two_stars:90,three_stars:95,_mobileKeyboard:""},initialize:function(){},refreshCookie:function(e,t){e=e||2;var s=$.cookie("userrem");if(t){var i=s.split("<");i[2]=2,s=i.join("<")}$.cookie("userrem",s,{expires:1/24*e,path:"/"})},loginWithData:function(e){for(var i,n=[],r=97;r<=122;r++)i={id:String.fromCharCode(r),typed:0,errors:0},e.letters_typed[String.fromCharCode(r)+"typed"]&&(i.typed=e.letters_typed[String.fromCharCode(r)+"typed"]),e.letters_typed[String.fromCharCode(r)+"errors"]&&(i.errors=e.letters_typed[String.fromCharCode(r)+"errors"]),n.push(i);var o=s.get("userLettersTyped");o.reset(n,{silent:!0}),o.setBackend(new t("userLettersTyped"),"model"),delete e.letters_typed;var a=s.get("userActivity");a.reset(e.activity,{silent:!0}),a.setBackend(new t("userActivity"),"model"),delete e.activity;var l=s.get("userLessons");l.reset(e.lessons,{silent:!0}),l.setBackend(new t("userLessons"),"model"),delete e.lessons;var c=s.get("userBadges");c.reset(e.badges,{silent:!0}),c.setBackend(new t("userBadges"),"model"),delete e.badges,e._lastSessionUpdate=Date.getUnixTime(),this.set(e,{silent:!0}),this.setBackend(new t("user"),"model")},clearLocalProgress:function(){s.get("userLettersTyped").reset(),s.get("userActivity").reset(),s.get("userLessons").reset(),s.get("userBadges").reset()},logOut:function(e){e=e||{};var s=function(){$.removeCookie("userrem",{path:"/"}),$.removeCookie("teacherrem",{path:"/"}),$.removeCookie("tc_skin",{path:"/"}),t.clear()}.bind(this);if(!e.ignoreServer)return $.post("/apiv1/student/auth/logout").done(s);s()},changeSkin:function(e){this.set({skin_id:e}),$.cookie("tc_skin",String(e),{expires:999,path:"/"}),FTWGLOBALS("loggedIn")&&$.post("/apiv1/student/user/account",{skin_id:e})}})}),define("global/views/header",["require","templates","registry"],function(e){"use strict";var t=e("templates"),s=e("registry");return Backbone.View.extend({el:"#header",events:{"click #logOutLink":"logOut"},initialize:function(){this.user=s.get("user"),this.template=t("global","header"),this.render()},render:function(){var e=this.user.get("first_name");return e||"username"!=this.user.get("login_type")||(e=this.user.get("username")),this.$el.html(this.template({data:this.user.toJSON(),page:FTWGLOBALS("page")||"",loggedIn:FTWGLOBALS("loggedIn"),displayName:e})),this},logOut:function(){return s.get("user").logOut().done(function(){location.href="/student/start"}),!1}})}),define("global/collections/user_lessons",["require","registry"],function(e){"use strict";var t=e("registry"),s=Backbone.Model.extend({idAttribute:"lesson_id",defaults:{progress:0,max_progress:0,typed:0,errors:0,seconds:0,times_completed:0,updated_at:0,created_at:0,last_save_response:null},saveStats:function(e,s){return e.user_id=t.get("user").id,e.user_session_id=t.get("user").get("user_session_id"),t.get("user").get("section_id")&&t.get("user").get("scoreboard")&&(e.section_id=t.get("user").get("section_id")),t.get("user").get("teacher_id")&&(e.teacher_id=t.get("user").get("teacher_id")),FTWGLOBALS("loggedIn")?$.postJSON("/apiv1/student/stats",{stats:e,keys:s}).done(function(e){e.data&&this.set({last_save_response:e.data})}.bind(this)):$.Deferred().resolve()},restart:function(){return FTWGLOBALS("loggedIn")?$.postJSON("/apiv1/student/lessons/restart",{lesson_id:this.id}):$.Deferred().resolve()}});return Backbone.Collection.extend({model:s})}),define("global/collections/user_activity",["require"],function(e){"use strict";var t=Backbone.Model.extend({idAttribute:"hour",defaults:{hour:0,typed:0,seconds:0,errors:0,screens:0,stars:0}});return Backbone.Collection.extend({model:t,comparator:"hour",merge:function(e){e.hour=e.created_at-e.created_at%3600,e.screens=1,e=_.mapObject(e,parseInt);var t=this.get(e.hour);t?t.inc({typed:e.typed,seconds:e.seconds,errors:e.errors,screens:e.screens,stars:e.stars}):this.add(e),e.hour=0,(t=this.get(0))?t.inc({typed:e.typed,seconds:e.seconds,errors:e.errors,screens:e.screens,stars:e.stars}):this.add(e)},getCompiled:function(e){if(0===e)return this.get(0)?this.get(0).toJSON():(new t).toJSON();var s=Date.getUnixTime()-86400*e;return this.toJSON().reduce(function(e,t){return t.hour>=s&&(e.typed+=parseInt(t.typed),e.seconds+=parseInt(t.seconds),e.errors+=parseInt(t.errors),e.screens+=parseInt(t.screens),e.stars+=parseInt(t.stars)),e},{typed:0,seconds:0,errors:0,screens:0,stars:0})}})}),define("global/collections/user_tests",["require"],function(e){"use strict";var t=Backbone.Model.extend({idAttribute:"user_test_id",defaults:{seconds:0,errors:0,typed:0,created_at:0}});return Backbone.Collection.extend({model:t,comparator:function(e){return-e.get("created_at")},url:function(){return"/apiv1/student/tests"}})}),define("global/collections/user_badges",["require"],function(e){"use strict";var t=Backbone.Model.extend({idAttribute:"lesson_id",defaults:{typed:0,errors:0,seconds:0,created_at:0}});return Backbone.Collection.extend({model:t,comparator:"created_at"})}),define("global/views/support",["require","templates","shared/form_model","shared/form_validation"],function(e){"use strict";var t=e("templates"),s=e("shared/form_model"),i=e("shared/form_validation"),n=s.extend({url:"/apiv1/student/auth/contact",defaults:{from:"student",name:"",email:"",message:"",reason:"",phone:"",page:""},validationRules:{name:{required:!0},email:{email:!0,required:!0},message:{required:!0},reason:{required:!0}}});return Backbone.View.extend({events:{"keypress input":"submitOnEnter"},baseModel:null,initialize:function(e){this.options=e,this.template=t("global","support"),this.model=new n({page:location.href})},render:function(){return this.$el.html(this.template({})),this.form=this.$("form"),new i(this.form,this.button,this.model,this.successCallback,this),this},ok:function(){this.form.submit()},successCallback:function(){this.trigger("complete")},submitOnEnter:function(e){13===e.keyCode&&(e.preventDefault(),$(e.currentTarget).blur(),this.form.submit())}})}),define("shared/helpers",["require"],function(e){"use strict";$(document).ajaxComplete(function(e,t,s){$._lastXhr={url:s.url,response:t.responseText}}),$.Velocity.RegisterEffect("ftw.miniShake",{defaultDuration:300,calls:[[{translateX:-6},.25],[{translateX:6},.25],[{translateX:-9},.25],[{translateX:0},.25]],reset:{translateX:0}}),$.Velocity.RegisterEffect("ftw.bigShrinkIn",{defaultDuration:750,calls:[[{opacity:[1,1],scale:[1,5]}]]}),$.Velocity.RegisterEffect("ftw.perspectiveShake",{defaultDuration:300,calls:[[{opacity:[1,0],transformPerspective:[800,800],rotateY:[15,-20]},null,{easing:"easeInOutQuad"}],[{transformPerspective:[800,800],rotateY:-15},null,{easing:"easeInOutQuad"}],[{transformPerspective:[800,800],rotateY:0},null,{easing:"easeInOutQuad"}]],reset:{transformPerspective:0,rotateY:0}}),$.Velocity.RegisterEffect("ftw.growUp",{defaultDuration:200,calls:[[{opacity:[1,0],scale:[1,0],transformOriginY:["100%","100%"]},1]]}),$.Velocity.RegisterEffect("ftw.fallIn",{defaultDuration:800,calls:[[{opacity:[1,0],translateY:[0,-75],translateZ:0},1,{easing:"spring"}]]}),String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,s){return void 0!==e[s]?e[s]:t})}),$.fn.fastHide=function(){return this.each(function(e,t){t.style.display="none"}),this},$.fn.fastShow=function(){return this.each(function(e,t){t.style.display="block"}),this},$.postJSON=function(e,t){return $.ajax({type:"POST",url:e,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(t)})},String.prototype.ucFirst=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},$.loginRedirect=function(e){var t=$.parseURL(location.href);t.pathname!=="/"+e+"/login"?location.href="/"+e+"/login#"+encodeURI("r:"+t.pathname+t.search+t.hash):location.reload()},$.parseURL=function(e){var t=document.createElement("a");return t.href=e,t},$.validator.addMethod("username",function(e,t){return e.toLowerCase().trim().match(/^[a-z0-9\-\._@]+$/i)},"Usernames can only contain letters, numbers, underscores, dashes, and dots."),$.validator.ignoreEmailExtended=function(e,t){var s=$(e).closest("form"),i=s.find("input[name="+t+"]");return i.data("emailExtended",i.val()),s.validate().element("input[name="+t+"]"),!1},$.validator.addMethod("emailExtended",function(e,t){return!Mailcheck.run({email:e})||$(t).data("emailExtended")==e||($.validator.messages.emailExtended='This email might contain a typo or mistake. <a href="#" onclick="$.validator.ignoreEmailExtended(this, \''+t.name+"'); return false;\">No, this is correct.</a>",!1)},"This email looks possibly invalid. Please double check."),$.validator.addMethod("notMatchUsername",function(e){return e!=this.findByName("username").val()},"Can not match username"),$.validator.addMethod("ips",function(e){return!e.trim()||!e.trim().split("\n").filter(function(e){return!e.trim().match(/^(?!0)(?!.*\.$)((1?\d?\d|25[0-5]|2[0-4]\d)(\.|$)){4}$/)}).length},"Contains at least one invalid IP address.  IPs are in the format A.B.C.D, for example 192.168.100.50."),$.validator.defaults.errorPlacement=function(e,t){t.parent().is("label")?t.parent().after(e):e.insertAfter(t)},Number.addCommas=function(e,t){void 0!==t&&(e=Number(e).toFixed(t)||0);var s=e.toString().split(".");return s[0]=s[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),s.join(".")},Number.prototype.addCommas=function(e){return Number.addCommas(this,e)},Number.prototype.countdownSeconds=function(e){e=e||!1;var t=Math.floor(this/60/60),s=Math.floor((this-60*t*60)/60),i=Math.floor(this-60*t*60-60*s),n="";return n=String(s).pad(t>0||e?2:1,"0","STR_PAD_LEFT")+":"+String(i).pad(2,"0","STR_PAD_LEFT"),(t>0||e)&&(n=String(t).pad(2,"0","STR_PAD_LEFT")+":"+n),n},String.prototype.nextLesson=function(){var e=this.lastIndexOf("/"),t=parseInt(this.substr(e+1));return!this.match(/\/student\/lessons\/\d+\/\w+/)||1!=t&&2!=t?this:this.substr(0,e+1)+(1==t?2:1)},String.prototype.slug=function(){return this.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")},String.prototype.pad=function(e,t,s){var i,n=this,r="",o=function(e,t){for(var s="";s.length<t;)s+=e;return s=s.substr(0,t)};return n+="",t=void 0!==t?t:" ","STR_PAD_LEFT"!==s&&"STR_PAD_RIGHT"!==s&&"STR_PAD_BOTH"!==s&&(s="STR_PAD_RIGHT"),(i=e-n.length)>0&&("STR_PAD_LEFT"===s?n=o(t,i)+n:"STR_PAD_RIGHT"===s?n+=o(t,i):"STR_PAD_BOTH"===s&&(n=(n=(r=o(t,Math.ceil(i/2)))+n+r).substr(0,e))),n},Number.prototype.ordinal=function(){var e=["th","st","nd","rd"],t=this%100;return e[(t-20)%10]||e[t]||e[0]},Date.getUnixTime=function(){return Math.floor(Date.now()/1e3)},Number.prototype.pluralize=function(e){return(e=e||!1)?1==this?"":"es":1==this?"":"s"},Math.long2ip=function(e){for(var t=e%256,s=1;s<=3;s++)t=(e=Math.floor(e/256))%256+"."+t;return t},$.getQueryParam=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))};var t=function(e,t){var s,i,n,r=new String,o=t.length;for(s=0;s<e.length;s++)n=e.charAt(s),(i=t.indexOf(n))>=0&&(n=t.charAt((i+o/2)%o)),r+=n;return r};window.rot47=function(e){new String;return t(e,"!\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~")},location.softReload=function(){try{location.href=location.href}catch(e){location.reload(!1)}};var s={};s.PADCHAR="=",s.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s.makeDOMException=function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(t){var e=new Error("DOM Exception 5");return e.code=e.number=5,e.name=e.description="INVALID_CHARACTER_ERR",e.toString=function(){return"Error: "+e.name+": "+e.message},e}},s.getbyte64=function(e,t){var i=s.ALPHA.indexOf(e.charAt(t));if(-1===i)throw s.makeDOMException();return i},s.decode=function(e){e=""+e;var t,i,n,r=s.getbyte64,o=e.length;if(0===o)return e;if(o%4!=0)throw s.makeDOMException();t=0,e.charAt(o-1)===s.PADCHAR&&(t=1,e.charAt(o-2)===s.PADCHAR&&(t=2),o-=4);var a=[];for(i=0;i<o;i+=4)n=r(e,i)<<18|r(e,i+1)<<12|r(e,i+2)<<6|r(e,i+3),a.push(String.fromCharCode(n>>16,n>>8&255,255&n));switch(t){case 1:n=r(e,i)<<18|r(e,i+1)<<12|r(e,i+2)<<6,a.push(String.fromCharCode(n>>16,n>>8&255));break;case 2:n=r(e,i)<<18|r(e,i+1)<<12,a.push(String.fromCharCode(n>>16))}return a.join("")},s.getbyte=function(e,t){var i=e.charCodeAt(t);if(i>255)throw s.makeDOMException();return i},s.encode=function(e){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");var t,i,n=s.PADCHAR,r=s.ALPHA,o=s.getbyte,a=[],l=(e=""+e).length-e.length%3;if(0===e.length)return e;for(t=0;t<l;t+=3)i=o(e,t)<<16|o(e,t+1)<<8|o(e,t+2),a.push(r.charAt(i>>18)),a.push(r.charAt(i>>12&63)),a.push(r.charAt(i>>6&63)),a.push(r.charAt(63&i));switch(e.length-l){case 1:i=o(e,t)<<16,a.push(r.charAt(i>>18)+r.charAt(i>>12&63)+n+n);break;case 2:i=o(e,t)<<16|o(e,t+1)<<8,a.push(r.charAt(i>>18)+r.charAt(i>>12&63)+r.charAt(i>>6&63)+n)}return a.join("")},window.btoa||(window.btoa=s.encode),window.atob||(window.atob=s.decode)}),define("shared/model",["require"],function(e){"use strict";Backbone.Model.prototype.parse=function(e){return _.isObject(e.data)&&_.isBoolean(e.success)?e.data:e},Backbone.Model.prototype.setBackend=function(e,t){return this.backend&&this.off("change",this.backend.change),e.setModel(this),this.on("change",e.change,e),"backend"==t?this.set(e.getData()):"model"==t&&e.setData(this.toJSON()),this.backend=e,this},Backbone.Model.prototype.inc=function(){if("object"==typeof arguments[0]){var e=null,t={};_.each(arguments[0],function(s,i){e=this.get(i)||0,t[i]=e+s},this),this.set(t,arguments[1])}else if("string"==typeof arguments[0]&&arguments[1]){e=this.get(arguments[0])||0;return(t={})[arguments[0]]=e+arguments[1],this.set(t,arguments[3])}}}),define("shared/collection",["require"],function(e){"use strict";Backbone.Collection.prototype.parse=function(e){return _.isObject(e.data)&&_.isBoolean(e.success)?e.data:e},Backbone.Collection.prototype.setBackend=function(e,t){return e.setModel(this),this.on("change",e.change,e),this.on("add",e.add,e),this.on("remove",e.remove,e),this.on("reset",e.reset,e),this.on("sort",e.sort,e),"backend"==t?this.reset(e.getData()):"model"==t&&e.setData(this.toJSON()),this},Backbone.Collection.prototype.sortField="",Backbone.Collection.prototype.sortDir="asc";var t=function(e,t){var s=e.get(this.sortField),i=t.get(this.sortField),n="asc"==this.sortDir?1:-1;return s<i?-1*n:s>i?1*n:0},s=function(e,s){var i=String(e.get(this.sortField)),n=String(s.get(this.sortField)),r="asc"==this.sortDir?1:-1;if("string"!=typeof i&&"string"!=typeof n)return t.call(this,e,s);var o,a,l,c,d,h,u=0,p=/(\.\d+)|(\d+(\.\d+)?)|([^\d.]+)|(\.\D+)|(\.$)/g;if(i===n)return 0;for(o=i.toLowerCase().match(p)||"",a=n.toLowerCase().match(p)||"",h=o.length;u<h;){if(!a[u])return 1*r;if(l=o[u],c=a[u++],l!==c)return d=l-c,isNaN(d)?(l>c?1:-1)*r:d*r}return(a[u]?-1:0)*r};Backbone.Collection.prototype.reSort=function(e,t){this.sortDir=t||("asc"==this.sortDir&&this.sortField==e?"desc":"asc"),this.sortField=e,this.comparator!==s&&(this.comparator=s),this.sort()}}),define("app",["require","router","registry","shared/analytics","shared/scoring","shared/radar_tracker","global/models/user","global/views/header","global/collections/user_lessons","global/collections/letters_typed","global/collections/user_activity","global/collections/user_tests","global/collections/user_badges","shared/model_backends/localstorage","shared/tooltip","global/views/notice","global/views/alert","global/views/modal","global/views/support","shared/helpers","shared/model","shared/collection"],function(e){"use strict";var t=e("router"),s=e("registry"),i=e("shared/analytics"),n=e("shared/scoring"),r=e("shared/radar_tracker"),o=e("global/models/user"),a=e("global/views/header"),l=e("global/collections/user_lessons"),c=e("global/collections/letters_typed"),d=e("global/collections/user_activity"),h=e("global/collections/user_tests"),u=e("global/collections/user_badges"),p=e("shared/model_backends/localstorage"),g=e("shared/tooltip"),m=e("global/views/notice"),f=e("global/views/alert"),y=e("global/views/modal"),b=e("global/views/support");return e("shared/helpers"),e("shared/model"),e("shared/collection"),{initialize:function(){this.browserCheck()&&(window.__NO_SCRIPTS||(this.globals(),"production"==FTWGLOBALS("env")&&this.analytics(),this.authentication({cookieName:"userrem"}),this.views(),this.support(),this.pageTrack(),this.router(),this.tracker(),this.tooltips()))},browserCheck:function(){var e=navigator.userAgent;if(e.match(/MSIE/)&&parseInt(e.match(/MSIE (\d+)/)[1],10)<10)return location.href="/failbrowser",!1;if(e.match(/Firefox/)&&parseInt(e.match(/Firefox\/(\d+)/)[1],10)<29)return location.href="/failbrowser",!1;if(!e.match("Chrome")&&e.match("Safari")&&e.match(/Version\/(\d+.\d+)/)&&parseFloat(e.match(/Version\/(\d+.\d+)/)[1])<5.1)return location.href="/failbrowser",!1;if(!window.__NO_SCRIPTS){try{window.localStorage.setItem("test","test")}catch(e){return navigator.userAgent.match(/safari/i)?alert("Typing.com can not be used in Safari while in Private Browsing Mode due to a bug in Safari. Please switch to normal browsing mode to use Typing.com, or switch to a different browser."):alert("Error: Your browser does not support Local Storage, or your Local Storage is full.  You will not be able to use Typing.com until this is resolved. Try updating your browser, or if you are in Private Browsing mode try normal mode."),!1}return!0}},globals:function(){s.set("data",window.FTW),s.set("isMobile",navigator.userAgent.match(/iPad|iPhone|Android/));var e=_.extend({},Backbone.Events);s.set("pubSub",e);var t=new o;t.setBackend(new p("user"),"backend"),s.set("user",t);var i=new l;i.setBackend(new p("userLessons"),"backend"),s.set("userLessons",i);var n=new d;n.setBackend(new p("userActivity"),"backend"),s.set("userActivity",n);var r=new u;r.setBackend(new p("userBadges"),"backend"),s.set("userBadges",r);var a=new h;a.setBackend(new p("userTests"),"backend"),s.set("userTests",a);var g=new c;g.setBackend(new p("userLettersTyped"),"backend"),s.set("userLettersTyped",g)},authentication:function(e){$.ajaxSetup({headers:{"X-CSRFToken":s.get("user").get("token"),"X-User-Id":s.get("user").id}});var t=this;if($(document).ajaxError(function(e,i){if(i.responseJSON&&i.responseJSON.data){var n=i.responseJSON.data.error;!FTWGLOBALS("loggedIn")||"LOGIN_REQUIRED"!=n&&"TOKEN_MISMATCH"!=n||(console.error("Invalid token or session"),s.get("user").logOut({ignoreServer:!0}),"production"==FTWGLOBALS("env")?location.href="/student":t.devLoggedOutNotice("Bad AJAX response: "+JSON.stringify({error:n,response:i})))}}),location.pathname.match(/^\/student\/oauth/))return!0;var i=FTWGLOBALS("loggedIn"),n=s.get("user"),r=($.cookie(e.cookieName)||"").split("<"),o=r[1];if(i){if(!n.id||o!=n.id)return n.logOut().done(function(){"production"==FTWGLOBALS("env")?location.reload():t.devLoggedOutNotice("LocalStorage ID does not match cookieUserId: "+JSON.stringify({"user.id":n.id,cookieUserId:o}))}),!1;n.refreshCookie(2),setTimeout(this.loggedOutNotice.bind(this),72e5)}else n.id&&(n.logOut({ignoreServer:!0}),"local"==FTWGLOBALS("env")&&t.devLoggedOutNotice("Not logged in, but has local storage: "+JSON.stringify({cookieParts:r,cookieUserId:o})),this.globals());return!0},loggedOutNotice:function(){new f({title:"Logged Out",text:"This account has been logged out due to inactivity. You must log back in to continue"}).show().on("close",function(){location.href="/student/login"})},views:function(){new a({model:s.get("user")})},support:function(){FTWGLOBALS("loggedIn")&&s.get("user").get("teacher_id")?$("#supportTab").remove():$("#supportTab").fastShow().click(function(){var e=new y({title:"Contact Support",okButton:"Send",cancelButton:"Cancel",contentView:new b,position:"absolute"});return e.on("complete",function(){new m({error:!1,text:"Your support request has been sent. We will get back to you shortly!"}).show()}.bind(this)),e.show(),!1})},devLoggedOutNotice:function(e){console.trace(),new f({title:"DEBUGGING NOTICE: Logged Out",text:"This account was just logged out.  Look at the console. "+e}).show()},router:function(){t.initialize()},tracker:function(){location.href.match(/lessons\/[0-9]+/)||r.track(s.get("user"))},pageTrack:function(){var e=rot47("student_pages"),t=localStorage.getItem(e)||0;t++,localStorage.setItem(e,t)},analytics:function(){var e=s.get("user");if(i.customDimension(1,FTWGLOBALS("loggedIn")?"yes":"no"),FTWGLOBALS("loggedIn")){e.get("teacher_id")?i.customDimension(2,"in class"):i.customDimension(2,"individual"),i.customDimension(3,e.get("login_type")),i.customDimension(4,e.get("membership")),i.customDimension(5,Math.floor(Math.floor(Date.now()/1e3-e.get("created_at"))/60/60/24));var t=s.get("userActivity").getCompiled(999),r=n.speed(t.typed,t.seconds);r>0&&(r=10*Math.floor(r/10),i.customDimension(6,r+"-"+(r+9)));var o=s.get("userLessons").toJSON().filter(function(e){return e.progress>0}).length;i.customDimension(7,o)}else i.customDimension(2,"anon");ga("send","pageview")},tooltips:function(){g.init()}}}),require.config({urlArgs:"bust="+(new Date).getTime(),baseUrl:"/src/student/js",paths:{shared:"../../shared",analytics:"../../shared/analytics",registry:"../../shared/registry",templates:"../../shared/templates"}}),require(["app"],function(e){$(function(){e.initialize()})}),define("main",function(){}),require(["app"]);